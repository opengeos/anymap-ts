import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{m as b}from"./maplibre-gl-BTjYUjN0.js";import{L as H}from"./maplibre-gl-layer-control-CsWFEept.js";import{D as Z}from"./DeckLayerAdapter-BLDh1d-e.js";import{b as U,c as _,e as K,C as q,d as $,M as Y}from"./mapbox-overlay-CtMyNbGZ.js";import{a as D,i as Q,g as X,b as ee,u as te}from"./tile-layer-DBA1YBdA.js";import{G as j}from"./geojson-layer-EKUXUQHB.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./composite-layer-D5nYxRM9.js";import"./bounding-box-from-points-BWnryCDX.js";import"./quaternion-BcOn_HKL.js";import"./utils-2CUC2toc.js";import"./icon-layer-BKQRWK27.js";import"./picking-CN0D5Hbh.js";import"./geometry-CwO1uo58.js";import"./scatterplot-layer-BXGDi6ex.js";import"./color-CUNNsFV-.js";import"./text-layer-oZ2F41A1.js";import"./path-layer-BvePX-Ox.js";import"./cut-by-mercator-bounds-DHiR3GA4.js";import"./solid-polygon-layer-CCl_BuGc.js";import"./polygon-utils-B8iYQ3Og.js";import"./gouraud-material-NoqXAwxE.js";import"./lighting-p30x1bFT.js";import"./phong-shaders-wgsl-3FV41e28.js";class v{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&U(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,o={updateTriggers:{}};for(const r in t)if(r in this.props){const i=t[r],s=this.props[r];o[r]=s,i&&i.type==="accessor"&&(o.updateTriggers[r]=this.props.updateTriggers[r],typeof s=="function"&&(o[r]=this.getSubLayerAccessor(s)))}return o}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}v.defaultProps={};v.extensionName="LayerExtension";const ne={clipBounds:[0,0,1,1],clipByInstance:void 0},M=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,oe={name:"clip",vs:M,uniformTypes:{bounds:"vec4<f32>"}},re={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},ie={name:"clip",fs:M,uniformTypes:{bounds:"vec4<f32>"}},se={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class x extends v{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[oe],inject:re}:{modules:[ie],inject:se}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const o=this.projectPosition([e[0],e[1],0]),r=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(o[0],r[0]),Math.min(o[1],r[1]),Math.max(o[0],r[0]),Math.max(o[1],r[1])]}this.setShaderModuleProps({clip:t})}}x.defaultProps=ne;x.extensionName="ClipExtension";function T(n,e){const t=e==null?void 0:e.globalFeatureId;return t!==void 0?ae(n,t):le(n,e==null?void 0:e.type)}function ae(n,e){const t=G(n);for(const o of t){let r=0,i=o.featureIds.value[0];for(let s=0;s<o.featureIds.value.length;s++){const l=o.featureIds.value[s];if(l!==i){if(e===o.globalFeatureIds.value[r])return h(o,r,s);r=s,i=l}}if(e===o.globalFeatureIds.value[r])return h(o,r,o.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function le(n,e){const t=G(n);return ue(t)}function ce(n,e,t){switch(n.type){case"Point":return he(n,e,t);case"LineString":return fe(n,e,t);case"Polygon":return E(n,e,t);default:const o=n;throw new Error(`Unsupported geometry type: ${o==null?void 0:o.type}`)}}function G(n,e){const t=[];return n.points&&(n.points.type="Point",t.push(n.points)),n.lines&&(n.lines.type="LineString",t.push(n.lines)),n.polygons&&(n.polygons.type="Polygon",t.push(n.polygons)),t}function ue(n){const e=[];for(const t of n){if(t.featureIds.value.length===0)continue;let o=0,r=t.featureIds.value[0];for(let i=0;i<t.featureIds.value.length;i++){const s=t.featureIds.value[i];s!==r&&(e.push(h(t,o,i)),o=i,r=s)}e.push(h(t,o,t.featureIds.value.length))}return e}function h(n,e,t){const o=ce(n,e,t),r=de(n,e),i=pe(n,e);return{type:"Feature",geometry:o,properties:r,...i}}function pe(n,e=0,t){return n.fields&&n.fields[n.featureIds.value[e]]}function de(n,e=0,t){const o=Object.assign({},n.properties[n.featureIds.value[e]]);for(const r in n.numericProps)o[r]=n.numericProps[r].value[e];return o}function E(n,e=-1/0,t=1/0){const{positions:o}=n,r=n.polygonIndices.value.filter(a=>a>=e&&a<=t),i=n.primitivePolygonIndices.value.filter(a=>a>=e&&a<=t);if(!(r.length>2)){const a=[];for(let c=0;c<i.length-1;c++){const u=i[c],p=i[c+1],m=y(o,u,p);a.push(m)}return{type:"Polygon",coordinates:a}}const l=[];for(let a=0;a<r.length-1;a++){const c=r[a],u=r[a+1],p=E(n,c,u).coordinates;l.push(p)}return{type:"MultiPolygon",coordinates:l}}function fe(n,e=-1/0,t=1/0){const{positions:o}=n,r=n.pathIndices.value.filter(l=>l>=e&&l<=t);if(!(r.length>2))return{type:"LineString",coordinates:y(o,r[0],r[1])};const s=[];for(let l=0;l<r.length-1;l++){const a=y(o,r[l],r[l+1]);s.push(a)}return{type:"MultiLineString",coordinates:s}}function he(n,e,t){const{positions:o}=n,r=y(o,e,t);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function y(n,e,t){e=e||0,t=t||n.value.length/n.size;const o=[];for(let r=e;r<t;r++){const i=Array();for(let s=r*n.size;s<(r+1)*n.size;s++)i.push(Number(n.value[s]));o.push(i)}return o}const ye="4.3.3",B={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:ye,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...B});const me={Point:A,MultiPoint:ge,LineString:k,MultiLineString:Ie,Polygon:R,MultiPolygon:be};function A([n,e],[t,o],r){const i=_(t[0],o[0],n),s=_(t[1],o[1],e);return r.unprojectFlat([i,s])}function L(n,e,t){return n.map(o=>A(o,e,t))}function ge(n,e,t){return L(n,e,t)}function k(n,e,t){return L(n,e,t)}function Ie(n,e,t){return n.map(o=>k(o,e,t))}function R(n,e,t){return n.map(o=>L(o,e,t))}function be(n,e,t){return n.map(o=>R(o,e,t))}function ve(n,e,t){const o=t.projectFlat([e.west,e.north]),r=t.projectFlat([e.east,e.south]),i=[o,r];return{...n,coordinates:me[n.type](n.coordinates,i,t)}}const xe=["points","lines","polygons"];function Le(n,e,t,o){for(const r of xe){const i=n[r]&&Pe(n[r],e,t,o);if(i>=0)return i}return-1}function Pe(n,e,t,o){const r=n.featureIds.value;if(!r.length)return-1;let i=0,s=r[r.length-1]+1;if(o){const a=Se(n,o);if(a)i=a[0],s=a[1]+1;else return-1}let l=-1;if(e in n.numericProps){const a=n.numericProps[e].value.findIndex((c,u)=>c===t&&r[u]>=i&&r[u]<s);return a>=0?n.globalFeatureIds.value[a]:-1}else e?l=w(n.properties,a=>a[e]===t,i,s):n.fields&&(l=w(n.fields,a=>a.id===t,i,s));return l>=0?Fe(n,l):-1}function Se(n,e){if(!n.__layers){const t={},{properties:o}=n;for(let r=0;r<o.length;r++){const{layerName:i}=o[r];i&&(t[i]?t[i][1]=r:t[i]=[r,r])}n.__layers=t}return n.__layers[e]}function Fe(n,e){if(!n.__ids){const t=[],o=n.featureIds.value,r=n.globalFeatureIds.value;for(let i=0;i<o.length;i++)t[o[i]]=r[i];n.__ids=t}return n.__ids[e]}function w(n,e,t,o){for(let r=t;r<o;r++)if(e(n[r],r))return r;return-1}const g=512,_e={...j.defaultProps,data:te,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[B],binary:!0};class P extends D{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return!!((e=this.state)!=null&&e.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:o,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:e,oldProps:t,context:o,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:i}=e;i!==t.highlightColor&&Array.isArray(i)&&this.setState({highlightColor:i})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!Q(e)){const{onDataLoad:o,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{t=await r(e,{propName:"data",layer:this,loaders:[]})}catch(i){this.raiseError(i,"loading TileJSON"),e=null}o&&o(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:o,maxZoom:r}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>o&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(r)||t.maxzoom<r)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return(e=this.state)!=null&&e.data?super.renderLayers():null}getTileData(e){const{data:t,binary:o}=this.state,{index:r,signal:i}=e,s=X(t,e);if(!s)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:a}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...l==null?void 0:l.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:r},gis:o?{format:"binary"}:{}},a(s,{propName:"data",layer:this,loadOptions:l,signal:i})}renderSubLayers(e){const{x:t,y:o,z:r}=e.tile.index,i=Math.pow(2,r),s=g/i,l=-s,a=g*t/i,c=g*(1-o/i),u=new K().scale([s,l,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=u,e.coordinateOrigin=[a,c,0],e.coordinateSystem=q.CARTESIAN,e.extensions=[...e.extensions||[],new x]);const p=super.renderSubLayers(e);return this.state.binary&&!(p instanceof j)&&$.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),p}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:o,hoveredFeatureLayerName:r}=this.state,i=e.object;let s=null,l=null;i&&(s=I(i,t),l=O(i));let{highlightColor:a}=this.props;typeof a=="function"&&(a=a(e)),(o!==s||r!==l)&&this.setState({highlightColor:a,hoveredFeatureId:s,hoveredFeatureLayerName:l})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:o}=e.sourceLayer.props;t.object=T(o,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=C(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:o,binary:r}=this.state,{uniqueIdProperty:i,highlightedFeatureId:s}=this.props,l=e.content,a=N(s);if(!(N(t)||a))return-1;const u=a?s:t;return Array.isArray(l)?l.findIndex(p=>{const m=I(p,i)===u,J=a||O(p)===o;return m&&J}):l&&r?Le(l,i,u,a?"":o):-1}_pickObjects(e){const{deck:t,viewport:o}=this.context,r=o.width,i=o.height,s=o.x,l=o.y,a=[this.id];return t.pickObjects({x:s,y:l,width:r,height:i,layerIds:a,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),o=new Set,r=[];for(const i of t){const s=I(i.object,this.props.uniqueIdProperty);s===void 0?r.push(i.object):o.has(s)||(o.add(s),r.push(i.object))}return r}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(o=>{o.hasOwnProperty(e)||Object.defineProperty(o,e,{get:()=>{if(!o.content)return null;if(this.state.binary&&Array.isArray(o.content)&&!o.content.length)return[];const{bbox:r}=o;if(o._contentWGS84===void 0&&ee(r)){const i=this.state.binary?T(o.content):o.content;o._contentWGS84=i.map(s=>C(s,r,this.context.viewport))}return o._contentWGS84}})})}}P.layerName="MVTLayer";P.defaultProps=_e;function I(n,e){if(n.properties&&e)return n.properties[e];if("id"in n)return n.id}function O(n){var e;return((e=n.properties)==null?void 0:e.layerName)||null}function N(n){return n!=null&&n!==""}function C(n,e,t){const o={...n,geometry:{type:n.geometry.type}};return Object.defineProperty(o.geometry,"coordinates",{get:()=>ve(n.geometry,e,t).coordinates}),o}const d=new b.Map({container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[-122.4,37.8],zoom:11});d.addControl(new b.NavigationControl,"top-right");d.addControl(new b.ScaleControl({unit:"metric"}),"bottom-right");const S=new Y({layers:[]}),F=new Map,V=new Z(d,S,F);let z=1;function Te(){S.setProps({layers:Array.from(F.values())})}function W(){const n="mvt-layer",e=new P({id:n,data:"https://tiles.basemaps.cartocdn.com/vectortiles/carto.streets/v1/{z}/{x}/{y}.mvt",minZoom:0,maxZoom:14,getLineColor:[255,255,255,200],getFillColor:[100,130,180,100],getLineWidth:z,lineWidthMinPixels:1,pickable:!0});F.set(n,e),Te(),V.notifyLayerAdded(n)}const f=document.getElementById("lineWidth"),we=document.getElementById("widthValue");f==null||f.addEventListener("input",()=>{z=parseInt(f.value,10),we.textContent=f.value,W()});d.on("load",()=>{d.addControl(S);const n=new H({collapsed:!0,customLayerAdapters:[V],panelWidth:360});d.addControl(n,"top-right"),W()});
