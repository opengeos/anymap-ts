import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{h as b}from"./maplibre-gl-C9tqRo8a.js";import{L as z}from"./maplibre-gl-layer-control-CbPNLzzp.js";import{D as O}from"./DeckLayerAdapter-kz44PQGX.js";import{d as j,C as N,M as _}from"./mapbox-overlay-B3MFwkdI.js";import{g as L,T as M,u as x}from"./tile-layer-nqxIxOC1.js";import{C as I}from"./composite-layer-CqqfW37O.js";import{S as w}from"./simple-mesh-layer-DkNMeaDt.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./preload-helper-PPVm8Dsz.js";import"./bounding-box-from-points-DEyWGT0V.js";import"./quaternion-Cnun7cGp.js";import"./geojson-layer-Cc6_dXch.js";import"./utils-2CUC2toc.js";import"./icon-layer-qEDNjw3T.js";import"./picking-CN0D5Hbh.js";import"./geometry-BcGx-jYG.js";import"./scatterplot-layer-Cd-PTS_D.js";import"./color-CUNNsFV-.js";import"./text-layer-DMgc0Dym.js";import"./path-layer-DtS7etqG.js";import"./cut-by-mercator-bounds-BIiGNyZq.js";import"./solid-polygon-layer-B9GT7vH1.js";import"./polygon-utils-B8iYQ3Og.js";import"./gouraud-material-DQO3ZmEl.js";import"./lighting-DGLKbg-X.js";import"./phong-shaders-wgsl-3FV41e28.js";import"./matrix-CjxQ2B22.js";import"./phong-material-B3sVKYdZ.js";const P="4.3.3",R={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:P,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...R});const D=[1],V={...M.defaultProps,elevationData:x,texture:{...x,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[R]};function C(n){return Array.isArray(n)?n.join(";"):n||""}class T extends I{updateState({props:e,oldProps:r}){const o=e.elevationData!==r.elevationData;if(o){const{elevationData:a}=e,t=a&&(Array.isArray(a)||Z(a));this.setState({isTiled:t})}const i=o||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&i){const a=this.loadTerrain(e);this.setState({terrain:a})}e.workerUrl&&j.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:o,meshMaxError:i,signal:a}){if(!e)return null;let t=this.getLoadOptions();t={...t,terrain:{skirtHeight:this.state.isTiled?i*2:0,...t?.terrain,bounds:r,meshMaxError:i,elevationDecoder:o}};const{fetch:l}=this.props;return l(e,{propName:"elevationData",layer:this,loadOptions:t,signal:a})}getTiledTerrainData(e){const{elevationData:r,fetch:o,texture:i,elevationDecoder:a,meshMaxError:t}=this.props,{viewport:l}=this.context,m=L(r,e),u=i&&L(i,e),{signal:h}=e;let c=[0,0],d=[0,0];if(l.isGeospatial){const s=e.bbox;c=l.projectFlat([s.west,s.south]),d=l.projectFlat([s.east,s.north])}else{const s=e.bbox;c=[s.left,s.bottom],d=[s.right,s.top]}const g=[c[0],c[1],d[0],d[1]],y=this.loadTerrain({elevationData:m,bounds:g,elevationDecoder:a,meshMaxError:t,signal:h}),f=u?o(u,{propName:"texture",layer:this,loaders:[],signal:h}).catch(s=>null):Promise.resolve(null);return Promise.all([y,f])}renderSubLayers(e){const r=this.getSubLayerClass("mesh",w),{color:o,wireframe:i,material:a}=this.props,{data:t}=e;if(!t)return null;const[l,m]=t;return new r(e,{data:D,mesh:l,texture:m,_instanced:!1,coordinateSystem:N.CARTESIAN,getPosition:u=>[0,0,0],getColor:o,wireframe:i,material:a})}onViewportLoad(e){if(!e)return;const{zRange:r}=this.state,o=e.map(t=>t.content).filter(Boolean).map(t=>t[0].header.boundingBox.map(m=>m[2]));if(o.length===0)return;const i=Math.min(...o.map(t=>t[0])),a=Math.max(...o.map(t=>t[1]));(!r||i<r[0]||a>r[1])&&this.setState({zRange:[i,a]})}renderLayers(){const{color:e,material:r,elevationData:o,texture:i,wireframe:a,meshMaxError:t,elevationDecoder:l,tileSize:m,maxZoom:u,minZoom:h,extent:c,maxRequests:d,onTileLoad:g,onTileUnload:y,onTileError:f,maxCacheSize:s,maxCacheByteSize:E,refinementStrategy:U}=this.props;if(this.state.isTiled)return new M(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:C(o),texture:C(i),meshMaxError:t,elevationDecoder:l}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:m,maxZoom:u,minZoom:h,extent:c,maxRequests:d,onTileLoad:g,onTileUnload:y,onTileError:f,maxCacheSize:s,maxCacheByteSize:E,refinementStrategy:U});if(!o)return null;const k=this.getSubLayerClass("mesh",w);return new k(this.getSubLayerProps({id:"mesh"}),{data:D,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:W=>[0,0,0],getColor:e,material:r,wireframe:a})}}T.defaultProps=V;T.layerName="TerrainLayer";const Z=n=>n.includes("{x}")&&(n.includes("{y}")||n.includes("{-y}")),B="https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",F="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",p=new b.Map({container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[-119.5,37.7],zoom:10,pitch:60,bearing:30});p.addControl(new b.NavigationControl,"top-right");p.addControl(new b.ScaleControl({unit:"metric"}),"bottom-right");const S=new _({layers:[]}),v=new Map,A=new O(p,S,v);function G(){S.setProps({layers:Array.from(v.values())})}function H(){const n="terrain-3d",e=new T({id:n,elevationData:B,texture:F,elevationDecoder:{rScaler:256,gScaler:1,bScaler:.00390625,offset:-32768},meshMaxError:4,opacity:1,pickable:!1});v.set(n,e),G(),A.notifyLayerAdded(n)}p.on("load",()=>{p.addControl(S);const n=new z({collapsed:!0,customLayerAdapters:[A],panelWidth:360});p.addControl(n,"top-right"),H()});
