import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{h as ue}from"./maplibre-gl-CBvcbTUS.js";import{L as Ye}from"./maplibre-gl-layer-control-CbPNLzzp.js";import{D as Je}from"./DeckLayerAdapter-CEH0-YJh.js";import{ab as ye,ac as Ke,g as je,a2 as Ze,C as be,M as He}from"./mapbox-overlay-B3MFwkdI.js";import{C as Qe}from"./composite-layer-CqqfW37O.js";import{B as De}from"./bitmap-layer-BpObQnXl.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./preload-helper-PPVm8Dsz.js";import"./picking-CN0D5Hbh.js";class et{fetch;loadOptions;_needsRefresh=!0;props;constructor(t){this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=tt(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){const n=this._needsRefresh;return t&&(this._needsRefresh=!1),n}}function tt(r){const t=r?.fetch;if(t&&typeof t=="function")return(a,f)=>t(a,f);const n=r?.fetch;return n&&typeof n!="function"?a=>fetch(a,n):a=>fetch(a)}class ce extends et{static type="template";static testURL=t=>!1}function rt(r){return typeof r=="string"?r.charAt(0).toLowerCase()+r.slice(1):r}function ae(r){if(Array.isArray(r))return r.map(t=>ae(t));if(r&&typeof r=="object"){const t={};for(const[n,a]of Object.entries(r))t[rt(n)]=ae(a);return t}return r}var J={},K={},Ee;function fe(){return Ee||(Ee=1,(function(r){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",a="["+t+"]["+n+"]*",f=new RegExp("^"+a+"$"),g=function(e,i){const c=[];let l=i.exec(e);for(;l;){const h=[];h.startIndex=i.lastIndex-l[0].length;const m=l.length;for(let E=0;E<m;E++)h.push(l[E]);c.push(h),l=i.exec(e)}return c},s=function(e){const i=f.exec(e);return!(i===null||typeof i>"u")};r.isExist=function(e){return typeof e<"u"},r.isEmptyObject=function(e){return Object.keys(e).length===0},r.merge=function(e,i,c){if(i){const l=Object.keys(i),h=l.length;for(let m=0;m<h;m++)c==="strict"?e[l[m]]=[i[l[m]]]:e[l[m]]=i[l[m]]}},r.getValue=function(e){return r.isExist(e)?e:""},r.isName=s,r.getAllMatches=g,r.nameRegexp=a})(K)),K}var we;function Ue(){if(we)return J;we=1;const r=fe(),t={allowBooleanAttributes:!1,unpairedTags:[]};J.validate=function(u,d){d=Object.assign({},t,d);const T=[];let A=!1,P=!1;u[0]==="\uFEFF"&&(u=u.substr(1));for(let o=0;o<u.length;o++)if(u[o]==="<"&&u[o+1]==="?"){if(o+=2,o=a(u,o),o.err)return o}else if(u[o]==="<"){let S=o;if(o++,u[o]==="!"){o=f(u,o);continue}else{let y=!1;u[o]==="/"&&(y=!0,o++);let p="";for(;o<u.length&&u[o]!==">"&&u[o]!==" "&&u[o]!=="	"&&u[o]!==`
`&&u[o]!=="\r";o++)p+=u[o];if(p=p.trim(),p[p.length-1]==="/"&&(p=p.substring(0,p.length-1),o--),!C(p)){let w;return p.trim().length===0?w="Invalid space after '<'.":w="Tag '"+p+"' is an invalid name.",m("InvalidTag",w,I(u,o))}const b=e(u,o);if(b===!1)return m("InvalidAttr","Attributes for '"+p+"' have open quote.",I(u,o));let x=b.value;if(o=b.index,x[x.length-1]==="/"){const w=o-x.length;x=x.substring(0,x.length-1);const O=c(x,d);if(O===!0)A=!0;else return m(O.err.code,O.err.msg,I(u,w+O.err.line))}else if(y)if(b.tagClosed){if(x.trim().length>0)return m("InvalidTag","Closing tag '"+p+"' can't have attributes or invalid starting.",I(u,S));if(T.length===0)return m("InvalidTag","Closing tag '"+p+"' has not been opened.",I(u,S));{const w=T.pop();if(p!==w.tagName){let O=I(u,w.tagStartPos);return m("InvalidTag","Expected closing tag '"+w.tagName+"' (opened in line "+O.line+", col "+O.col+") instead of closing tag '"+p+"'.",I(u,S))}T.length==0&&(P=!0)}}else return m("InvalidTag","Closing tag '"+p+"' doesn't have proper closing.",I(u,o));else{const w=c(x,d);if(w!==!0)return m(w.err.code,w.err.msg,I(u,o-x.length+w.err.line));if(P===!0)return m("InvalidXml","Multiple possible root nodes found.",I(u,o));d.unpairedTags.indexOf(p)!==-1||T.push({tagName:p,tagStartPos:S}),A=!0}for(o++;o<u.length;o++)if(u[o]==="<")if(u[o+1]==="!"){o++,o=f(u,o);continue}else if(u[o+1]==="?"){if(o=a(u,++o),o.err)return o}else break;else if(u[o]==="&"){const w=h(u,o);if(w==-1)return m("InvalidChar","char '&' is not expected.",I(u,o));o=w}else if(P===!0&&!n(u[o]))return m("InvalidXml","Extra text at the end",I(u,o));u[o]==="<"&&o--}}else{if(n(u[o]))continue;return m("InvalidChar","char '"+u[o]+"' is not expected.",I(u,o))}if(A){if(T.length==1)return m("InvalidTag","Unclosed tag '"+T[0].tagName+"'.",I(u,T[0].tagStartPos));if(T.length>0)return m("InvalidXml","Invalid '"+JSON.stringify(T.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return m("InvalidXml","Start tag expected.",1);return!0};function n(u){return u===" "||u==="	"||u===`
`||u==="\r"}function a(u,d){const T=d;for(;d<u.length;d++)if(u[d]=="?"||u[d]==" "){const A=u.substr(T,d-T);if(d>5&&A==="xml")return m("InvalidXml","XML declaration allowed only at the start of the document.",I(u,d));if(u[d]=="?"&&u[d+1]==">"){d++;break}else continue}return d}function f(u,d){if(u.length>d+5&&u[d+1]==="-"&&u[d+2]==="-"){for(d+=3;d<u.length;d++)if(u[d]==="-"&&u[d+1]==="-"&&u[d+2]===">"){d+=2;break}}else if(u.length>d+8&&u[d+1]==="D"&&u[d+2]==="O"&&u[d+3]==="C"&&u[d+4]==="T"&&u[d+5]==="Y"&&u[d+6]==="P"&&u[d+7]==="E"){let T=1;for(d+=8;d<u.length;d++)if(u[d]==="<")T++;else if(u[d]===">"&&(T--,T===0))break}else if(u.length>d+9&&u[d+1]==="["&&u[d+2]==="C"&&u[d+3]==="D"&&u[d+4]==="A"&&u[d+5]==="T"&&u[d+6]==="A"&&u[d+7]==="["){for(d+=8;d<u.length;d++)if(u[d]==="]"&&u[d+1]==="]"&&u[d+2]===">"){d+=2;break}}return d}const g='"',s="'";function e(u,d){let T="",A="",P=!1;for(;d<u.length;d++){if(u[d]===g||u[d]===s)A===""?A=u[d]:A!==u[d]||(A="");else if(u[d]===">"&&A===""){P=!0;break}T+=u[d]}return A!==""?!1:{value:T,index:d,tagClosed:P}}const i=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function c(u,d){const T=r.getAllMatches(u,i),A={};for(let P=0;P<T.length;P++){if(T[P][1].length===0)return m("InvalidAttr","Attribute '"+T[P][2]+"' has no space in starting.",R(T[P]));if(T[P][3]!==void 0&&T[P][4]===void 0)return m("InvalidAttr","Attribute '"+T[P][2]+"' is without value.",R(T[P]));if(T[P][3]===void 0&&!d.allowBooleanAttributes)return m("InvalidAttr","boolean attribute '"+T[P][2]+"' is not allowed.",R(T[P]));const o=T[P][2];if(!E(o))return m("InvalidAttr","Attribute '"+o+"' is an invalid name.",R(T[P]));if(!A.hasOwnProperty(o))A[o]=1;else return m("InvalidAttr","Attribute '"+o+"' is repeated.",R(T[P]))}return!0}function l(u,d){let T=/\d/;for(u[d]==="x"&&(d++,T=/[\da-fA-F]/);d<u.length;d++){if(u[d]===";")return d;if(!u[d].match(T))break}return-1}function h(u,d){if(d++,u[d]===";")return-1;if(u[d]==="#")return d++,l(u,d);let T=0;for(;d<u.length;d++,T++)if(!(u[d].match(/\w/)&&T<20)){if(u[d]===";")break;return-1}return d}function m(u,d,T){return{err:{code:u,msg:d,line:T.line||T,col:T.col}}}function E(u){return r.isName(u)}function C(u){return r.isName(u)}function I(u,d){const T=u.substring(0,d).split(/\r?\n/);return{line:T.length,col:T[T.length-1].length+1}}function R(u){return u.startIndex+u[1].length}return J}var X={},Ne;function st(){if(Ne)return X;Ne=1;const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,f){return f},attributeValueProcessor:function(a,f){return f},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,f,g){return a},captureMetaData:!1,maxNestedTags:100,strictReservedNames:!0};function t(a){return typeof a=="boolean"?{enabled:a,maxEntitySize:1e4,maxExpansionDepth:10,maxTotalExpansions:1e3,maxExpandedLength:1e5,allowedTags:null,tagFilter:null}:typeof a=="object"&&a!==null?{enabled:a.enabled!==!1,maxEntitySize:a.maxEntitySize??1e4,maxExpansionDepth:a.maxExpansionDepth??10,maxTotalExpansions:a.maxTotalExpansions??1e3,maxExpandedLength:a.maxExpandedLength??1e5,allowedTags:a.allowedTags??null,tagFilter:a.tagFilter??null}:t(!0)}const n=function(a){const f=Object.assign({},r,a);return f.processEntities=t(f.processEntities),f};return X.buildOptions=n,X.defaultOptions=r,X}var j,Te;function nt(){if(Te)return j;Te=1;class r{constructor(n){this.tagname=n,this.child=[],this[":@"]={}}add(n,a){n==="__proto__"&&(n="#__proto__"),this.child.push({[n]:a})}addChild(n){n.tagname==="__proto__"&&(n.tagname="#__proto__"),n[":@"]&&Object.keys(n[":@"]).length>0?this.child.push({[n.tagname]:n.child,":@":n[":@"]}):this.child.push({[n.tagname]:n.child})}}return j=r,j}var Z,Se;function it(){if(Se)return Z;Se=1;const r=fe();class t{constructor(s){this.suppressValidationErr=!s,this.options=s||{}}readDocType(s,e){const i=Object.create(null);if(s[e+3]==="O"&&s[e+4]==="C"&&s[e+5]==="T"&&s[e+6]==="Y"&&s[e+7]==="P"&&s[e+8]==="E"){e=e+9;let c=1,l=!1,h=!1,m="";for(;e<s.length;e++)if(s[e]==="<"&&!h){if(l&&a(s,"!ENTITY",e)){e+=7;let E,C;if([E,C,e]=this.readEntityExp(s,e+1,this.suppressValidationErr),C.indexOf("&")===-1){const I=E.replace(/[.\-+*:]/g,"\\.");i[E]={regx:RegExp(`&${I};`,"g"),val:C}}}else if(l&&a(s,"!ELEMENT",e)){e+=8;const{index:E}=this.readElementExp(s,e+1);e=E}else if(l&&a(s,"!ATTLIST",e))e+=8;else if(l&&a(s,"!NOTATION",e)){e+=9;const{index:E}=this.readNotationExp(s,e+1,this.suppressValidationErr);e=E}else if(a(s,"!--",e))h=!0;else throw new Error("Invalid DOCTYPE");c++,m=""}else if(s[e]===">"){if(h?s[e-1]==="-"&&s[e-2]==="-"&&(h=!1,c--):c--,c===0)break}else s[e]==="["?l=!0:m+=s[e];if(c!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:i,i:e}}readEntityExp(s,e){e=n(s,e);let i="";for(;e<s.length&&!/\s/.test(s[e])&&s[e]!=='"'&&s[e]!=="'";)i+=s[e],e++;if(f(i),e=n(s,e),!this.suppressValidationErr){if(s.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(s[e]==="%")throw new Error("Parameter entities are not supported")}let c="";if([e,c]=this.readIdentifierVal(s,e,"entity"),this.options.enabled!==!1&&this.options.maxEntitySize&&c.length>this.options.maxEntitySize)throw new Error(`Entity "${i}" size (${c.length}) exceeds maximum allowed size (${this.options.maxEntitySize})`);return e--,[i,c,e]}readNotationExp(s,e){e=n(s,e);let i="";for(;e<s.length&&!/\s/.test(s[e]);)i+=s[e],e++;!this.suppressValidationErr&&f(i),e=n(s,e);const c=s.substring(e,e+6).toUpperCase();if(!this.suppressValidationErr&&c!=="SYSTEM"&&c!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${c}"`);e+=c.length,e=n(s,e);let l=null,h=null;if(c==="PUBLIC")[e,l]=this.readIdentifierVal(s,e,"publicIdentifier"),e=n(s,e),(s[e]==='"'||s[e]==="'")&&([e,h]=this.readIdentifierVal(s,e,"systemIdentifier"));else if(c==="SYSTEM"&&([e,h]=this.readIdentifierVal(s,e,"systemIdentifier"),!this.suppressValidationErr&&!h))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:i,publicIdentifier:l,systemIdentifier:h,index:--e}}readIdentifierVal(s,e,i){let c="";const l=s[e];if(l!=='"'&&l!=="'")throw new Error(`Expected quoted string, found "${l}"`);for(e++;e<s.length&&s[e]!==l;)c+=s[e],e++;if(s[e]!==l)throw new Error(`Unterminated ${i} value`);return e++,[e,c]}readElementExp(s,e){e=n(s,e);let i="";for(;e<s.length&&!/\s/.test(s[e]);)i+=s[e],e++;if(!this.suppressValidationErr&&!r.isName(i))throw new Error(`Invalid element name: "${i}"`);e=n(s,e);let c="";if(s[e]==="E"&&a(s,"MPTY",e))e+=4;else if(s[e]==="A"&&a(s,"NY",e))e+=2;else if(s[e]==="("){for(e++;e<s.length&&s[e]!==")";)c+=s[e],e++;if(s[e]!==")")throw new Error("Unterminated content model")}else if(!this.suppressValidationErr)throw new Error(`Invalid Element Expression, found "${s[e]}"`);return{elementName:i,contentModel:c.trim(),index:e}}readAttlistExp(s,e){e=n(s,e);let i="";for(;e<s.length&&!/\s/.test(s[e]);)i+=s[e],e++;f(i),e=n(s,e);let c="";for(;e<s.length&&!/\s/.test(s[e]);)c+=s[e],e++;if(!f(c))throw new Error(`Invalid attribute name: "${c}"`);e=n(s,e);let l="";if(s.substring(e,e+8).toUpperCase()==="NOTATION"){if(l="NOTATION",e+=8,e=n(s,e),s[e]!=="(")throw new Error(`Expected '(', found "${s[e]}"`);e++;let m=[];for(;e<s.length&&s[e]!==")";){let E="";for(;e<s.length&&s[e]!=="|"&&s[e]!==")";)E+=s[e],e++;if(E=E.trim(),!f(E))throw new Error(`Invalid notation name: "${E}"`);m.push(E),s[e]==="|"&&(e++,e=n(s,e))}if(s[e]!==")")throw new Error("Unterminated list of notations");e++,l+=" ("+m.join("|")+")"}else{for(;e<s.length&&!/\s/.test(s[e]);)l+=s[e],e++;const m=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!m.includes(l.toUpperCase()))throw new Error(`Invalid attribute type: "${l}"`)}e=n(s,e);let h="";return s.substring(e,e+8).toUpperCase()==="#REQUIRED"?(h="#REQUIRED",e+=8):s.substring(e,e+7).toUpperCase()==="#IMPLIED"?(h="#IMPLIED",e+=7):[e,h]=this.readIdentifierVal(s,e,"ATTLIST"),{elementName:i,attributeName:c,attributeType:l,defaultValue:h,index:e}}}const n=(g,s)=>{for(;s<g.length&&/\s/.test(g[s]);)s++;return s};function a(g,s,e){for(let i=0;i<s.length;i++)if(s[i]!==g[e+i+1])return!1;return!0}function f(g){if(r.isName(g))return g;throw new Error(`Invalid entity name ${g}`)}return Z=t,Z}var H,xe;function ot(){if(xe)return H;xe=1;const r=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,n={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function a(s,e={}){if(e=Object.assign({},n,e),!s||typeof s!="string")return s;let i=s.trim();if(e.skipLike!==void 0&&e.skipLike.test(i))return s;if(s==="0")return 0;if(e.hex&&r.test(i))return g(i,16);if(i.search(/[eE]/)!==-1){const c=i.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(c){if(e.leadingZeros)i=(c[1]||"")+c[3];else if(!(c[2]==="0"&&c[3][0]==="."))return s;return e.eNotation?Number(i):s}else return s}else{const c=t.exec(i);if(c){const l=c[1],h=c[2];let m=f(c[3]);if(!e.leadingZeros&&h.length>0&&l&&i[2]!==".")return s;if(!e.leadingZeros&&h.length>0&&!l&&i[1]!==".")return s;if(e.leadingZeros&&h===s)return 0;{const E=Number(i),C=""+E;return C.search(/[eE]/)!==-1?e.eNotation?E:s:i.indexOf(".")!==-1?C==="0"&&m===""||C===m||l&&C==="-"+m?E:s:h?m===C||l+m===C?E:s:i===C||i===l+C?E:s}}else return s}}function f(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function g(s,e){if(parseInt)return parseInt(s,e);if(Number.parseInt)return Number.parseInt(s,e);if(window&&window.parseInt)return window.parseInt(s,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}return H=a,H}var Q,Ie;function qe(){if(Ie)return Q;Ie=1;function r(t){return typeof t=="function"?t:Array.isArray(t)?n=>{for(const a of t)if(typeof a=="string"&&n===a||a instanceof RegExp&&a.test(n))return!0}:()=>!1}return Q=r,Q}var D,Le;function at(){if(Le)return D;Le=1;const r=fe(),t=nt(),n=it(),a=ot(),f=qe();class g{constructor(S){if(this.options=S,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(y,p)=>P(p,10,"&#")},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(y,p)=>P(p,16,"&#x")}},this.addExternalEntities=s,this.parseXml=h,this.parseTextData=e,this.resolveNameSpace=i,this.buildAttributesMap=l,this.isItStopNode=I,this.replaceEntitiesValue=E,this.readStopNodeData=T,this.saveTextToParentTag=C,this.addChild=m,this.ignoreAttributesFn=f(this.options.ignoreAttributes),this.entityExpansionCount=0,this.currentExpandedLength=0,this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let y=0;y<this.options.stopNodes.length;y++){const p=this.options.stopNodes[y];typeof p=="string"&&(p.startsWith("*.")?this.stopNodesWildcard.add(p.substring(2)):this.stopNodesExact.add(p))}}}}function s(o){const S=Object.keys(o);for(let y=0;y<S.length;y++){const p=S[y],b=p.replace(/[.\-+*:]/g,"\\.");this.lastEntities[p]={regex:new RegExp("&"+b+";","g"),val:o[p]}}}function e(o,S,y,p,b,x,w){if(o!==void 0&&(this.options.trimValues&&!p&&(o=o.trim()),o.length>0)){w||(o=this.replaceEntitiesValue(o,S,y));const O=this.options.tagValueProcessor(S,o,y,b,x);return O==null?o:typeof O!=typeof o||O!==o?O:this.options.trimValues?A(o,this.options.parseTagValue,this.options.numberParseOptions):o.trim()===o?A(o,this.options.parseTagValue,this.options.numberParseOptions):o}}function i(o){if(this.options.removeNSPrefix){const S=o.split(":"),y=o.charAt(0)==="/"?"/":"";if(S[0]==="xmlns")return"";S.length===2&&(o=y+S[1])}return o}const c=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function l(o,S,y){if(this.options.ignoreAttributes!==!0&&typeof o=="string"){const p=r.getAllMatches(o,c),b=p.length,x={};for(let w=0;w<b;w++){const O=this.resolveNameSpace(p[w][1]);if(this.ignoreAttributesFn(O,S))continue;let L=p[w][4],N=this.options.attributeNamePrefix+O;if(O.length)if(this.options.transformAttributeName&&(N=this.options.transformAttributeName(N)),N==="__proto__"&&(N="#__proto__"),L!==void 0){this.options.trimValues&&(L=L.trim()),L=this.replaceEntitiesValue(L,y,S);const B=this.options.attributeValueProcessor(O,L,S);B==null?x[N]=L:typeof B!=typeof L||B!==L?x[N]=B:x[N]=A(L,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(x[N]=!0)}if(!Object.keys(x).length)return;if(this.options.attributesGroupName){const w={};return w[this.options.attributesGroupName]=x,w}return x}}const h=function(o){o=o.replace(/\r\n?/g,`
`);const S=new t("!xml");let y=S,p="",b="";this.entityExpansionCount=0,this.currentExpandedLength=0;const x=new n(this.options.processEntities);for(let w=0;w<o.length;w++)if(o[w]==="<")if(o[w+1]==="/"){const L=u(o,">",w,"Closing Tag is not closed.");let N=o.substring(w+2,L).trim();if(this.options.removeNSPrefix){const _=N.indexOf(":");_!==-1&&(N=N.substr(_+1))}this.options.transformTagName&&(N=this.options.transformTagName(N)),y&&(p=this.saveTextToParentTag(p,y,b));const B=b.substring(b.lastIndexOf(".")+1);if(N&&this.options.unpairedTags.indexOf(N)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${N}>`);let v=0;B&&this.options.unpairedTags.indexOf(B)!==-1?(v=b.lastIndexOf(".",b.lastIndexOf(".")-1),this.tagsNodeStack.pop()):v=b.lastIndexOf("."),b=b.substring(0,v),y=this.tagsNodeStack.pop(),p="",w=L}else if(o[w+1]==="?"){let L=d(o,w,!1,"?>");if(!L)throw new Error("Pi Tag is not closed.");if(p=this.saveTextToParentTag(p,y,b),!(this.options.ignoreDeclaration&&L.tagName==="?xml"||this.options.ignorePiTags)){const N=new t(L.tagName);N.add(this.options.textNodeName,""),L.tagName!==L.tagExp&&L.attrExpPresent&&(N[":@"]=this.buildAttributesMap(L.tagExp,b,L.tagName)),this.addChild(y,N,b,w)}w=L.closeIndex+1}else if(o.substr(w+1,3)==="!--"){const L=u(o,"-->",w+4,"Comment is not closed.");if(this.options.commentPropName){const N=o.substring(w+4,L-2);p=this.saveTextToParentTag(p,y,b),y.add(this.options.commentPropName,[{[this.options.textNodeName]:N}])}w=L}else if(o.substr(w+1,2)==="!D"){const L=x.readDocType(o,w);this.docTypeEntities=L.entities,w=L.i}else if(o.substr(w+1,2)==="!["){const L=u(o,"]]>",w,"CDATA is not closed.")-2,N=o.substring(w+9,L);p=this.saveTextToParentTag(p,y,b);let B=this.parseTextData(N,y.tagname,b,!0,!1,!0,!0);B==null&&(B=""),this.options.cdataPropName?y.add(this.options.cdataPropName,[{[this.options.textNodeName]:N}]):y.add(this.options.textNodeName,B),w=L+2}else{let L=d(o,w,this.options.removeNSPrefix),N=L.tagName;const B=L.rawTagName;let v=L.tagExp,_=L.attrExpPresent,ge=L.closeIndex;if(this.options.transformTagName){const M=this.options.transformTagName(N);v===N&&(v=M),N=M}if(this.options.strictReservedNames&&(N===this.options.commentPropName||N===this.options.cdataPropName))throw new Error(`Invalid tag name: ${N}`);y&&p&&y.tagname!=="!xml"&&(p=this.saveTextToParentTag(p,y,b,!1));const me=y;me&&this.options.unpairedTags.indexOf(me.tagname)!==-1&&(y=this.tagsNodeStack.pop(),b=b.substring(0,b.lastIndexOf("."))),N!==S.tagname&&(b+=b?"."+N:N);const z=w;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,b,N)){let M="";if(v.length>0&&v.lastIndexOf("/")===v.length-1)N[N.length-1]==="/"?(N=N.substr(0,N.length-1),b=b.substr(0,b.length-1),v=N):v=v.substr(0,v.length-1),w=L.closeIndex;else if(this.options.unpairedTags.indexOf(N)!==-1)w=L.closeIndex;else{const Y=this.readStopNodeData(o,B,ge+1);if(!Y)throw new Error(`Unexpected end of ${B}`);w=Y.i,M=Y.tagContent}const F=new t(N);N!==v&&_&&(F[":@"]=this.buildAttributesMap(v,b,N)),M&&(M=this.parseTextData(M,N,b,!0,_,!0,!0)),b=b.substr(0,b.lastIndexOf(".")),F.add(this.options.textNodeName,M),this.addChild(y,F,b,z)}else{if(v.length>0&&v.lastIndexOf("/")===v.length-1){if(N[N.length-1]==="/"?(N=N.substr(0,N.length-1),b=b.substr(0,b.length-1),v=N):v=v.substr(0,v.length-1),this.options.transformTagName){const F=this.options.transformTagName(N);v===N&&(v=F),N=F}const M=new t(N);N!==v&&_&&(M[":@"]=this.buildAttributesMap(v,b,N)),this.addChild(y,M,b,z),b=b.substr(0,b.lastIndexOf("."))}else if(this.options.unpairedTags.indexOf(N)!==-1){const M=new t(N);N!==v&&_&&(M[":@"]=this.buildAttributesMap(v,b)),this.addChild(y,M,b,z),b=b.substr(0,b.lastIndexOf(".")),w=L.closeIndex;continue}else{const M=new t(N);if(this.tagsNodeStack.length>this.options.maxNestedTags)throw new Error("Maximum nested tags exceeded");this.tagsNodeStack.push(y),N!==v&&_&&(M[":@"]=this.buildAttributesMap(v,b,N)),this.addChild(y,M,b),y=M}p="",w=ge}}else p+=o[w];return S.child};function m(o,S,y,p){this.options.captureMetaData||(p=void 0);const b=this.options.updateTag(S.tagname,y,S[":@"]);b===!1||(typeof b=="string"&&(S.tagname=b),o.addChild(S,p))}const E=function(o,S,y){if(o.indexOf("&")===-1)return o;const p=this.options.processEntities;if(!p.enabled||p.allowedTags&&!p.allowedTags.includes(S)||p.tagFilter&&!p.tagFilter(S,y))return o;for(let b in this.docTypeEntities){const x=this.docTypeEntities[b],w=o.match(x.regx);if(w){if(this.entityExpansionCount+=w.length,p.maxTotalExpansions&&this.entityExpansionCount>p.maxTotalExpansions)throw new Error(`Entity expansion limit exceeded: ${this.entityExpansionCount} > ${p.maxTotalExpansions}`);const O=o.length;if(o=o.replace(x.regx,x.val),p.maxExpandedLength&&(this.currentExpandedLength+=o.length-O,this.currentExpandedLength>p.maxExpandedLength))throw new Error(`Total expanded content size exceeded: ${this.currentExpandedLength} > ${p.maxExpandedLength}`)}}if(o.indexOf("&")===-1)return o;for(let b in this.lastEntities){const x=this.lastEntities[b];o=o.replace(x.regex,x.val)}if(o.indexOf("&")===-1)return o;if(this.options.htmlEntities)for(let b in this.htmlEntities){const x=this.htmlEntities[b];o=o.replace(x.regex,x.val)}return o=o.replace(this.ampEntity.regex,this.ampEntity.val),o};function C(o,S,y,p){return o&&(p===void 0&&(p=S.child.length===0),o=this.parseTextData(o,S.tagname,y,!1,S[":@"]?Object.keys(S[":@"]).length!==0:!1,p),o!==void 0&&o!==""&&S.add(this.options.textNodeName,o),o=""),o}function I(o,S,y,p){return!!(S&&S.has(p)||o&&o.has(y))}function R(o,S,y=">"){let p,b="";for(let x=S;x<o.length;x++){let w=o[x];if(p)w===p&&(p="");else if(w==='"'||w==="'")p=w;else if(w===y[0])if(y[1]){if(o[x+1]===y[1])return{data:b,index:x}}else return{data:b,index:x};else w==="	"&&(w=" ");b+=w}}function u(o,S,y,p){const b=o.indexOf(S,y);if(b===-1)throw new Error(p);return b+S.length-1}function d(o,S,y,p=">"){const b=R(o,S+1,p);if(!b)return;let x=b.data;const w=b.index,O=x.search(/\s/);let L=x,N=!0;O!==-1&&(L=x.substring(0,O),x=x.substring(O+1).trimStart());const B=L;if(y){const v=L.indexOf(":");v!==-1&&(L=L.substr(v+1),N=L!==b.data.substr(v+1))}return{tagName:L,tagExp:x,closeIndex:w,attrExpPresent:N,rawTagName:B}}function T(o,S,y){const p=y;let b=1;for(;y<o.length;y++)if(o[y]==="<")if(o[y+1]==="/"){const x=u(o,">",y,`${S} is not closed`);if(o.substring(y+2,x).trim()===S&&(b--,b===0))return{tagContent:o.substring(p,y),i:x};y=x}else if(o[y+1]==="?")y=u(o,"?>",y+1,"StopNode is not closed.");else if(o.substr(y+1,3)==="!--")y=u(o,"-->",y+3,"StopNode is not closed.");else if(o.substr(y+1,2)==="![")y=u(o,"]]>",y,"StopNode is not closed.")-2;else{const x=d(o,y,">");x&&((x&&x.tagName)===S&&x.tagExp[x.tagExp.length-1]!=="/"&&b++,y=x.closeIndex)}}function A(o,S,y){if(S&&typeof o=="string"){const p=o.trim();return p==="true"?!0:p==="false"?!1:a(o,y)}else return r.isExist(o)?o:""}function P(o,S,y){const p=Number.parseInt(o,S);return p>=0&&p<=1114111?String.fromCodePoint(p):y+o+";"}return D=g,D}var ee={},Ce;function ut(){if(Ce)return ee;Ce=1;function r(g,s){return t(g,s)}function t(g,s,e){let i;const c={};for(let l=0;l<g.length;l++){const h=g[l],m=n(h);let E="";if(e===void 0?E=m:E=e+"."+m,m===s.textNodeName)i===void 0?i=h[m]:i+=""+h[m];else{if(m===void 0)continue;if(h[m]){let C=t(h[m],s,E);const I=f(C,s);h[":@"]?a(C,h[":@"],E,s):Object.keys(C).length===1&&C[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?C=C[s.textNodeName]:Object.keys(C).length===0&&(s.alwaysCreateTextNode?C[s.textNodeName]="":C=""),c[m]!==void 0&&c.hasOwnProperty(m)?(Array.isArray(c[m])||(c[m]=[c[m]]),c[m].push(C)):s.isArray(m,E,I)?c[m]=[C]:c[m]=C}}}return typeof i=="string"?i.length>0&&(c[s.textNodeName]=i):i!==void 0&&(c[s.textNodeName]=i),c}function n(g){const s=Object.keys(g);for(let e=0;e<s.length;e++){const i=s[e];if(i!==":@")return i}}function a(g,s,e,i){if(s){const c=Object.keys(s),l=c.length;for(let h=0;h<l;h++){const m=c[h];i.isArray(m,e+"."+m,!0,!0)?g[m]=[s[m]]:g[m]=s[m]}}}function f(g,s){const{textNodeName:e}=s,i=Object.keys(g).length;return!!(i===0||i===1&&(g[e]||typeof g[e]=="boolean"||g[e]===0))}return ee.prettify=r,ee}var te,ve;function ct(){if(ve)return te;ve=1;const{buildOptions:r}=st(),t=at(),{prettify:n}=ut(),a=Ue();class f{constructor(s){this.externalEntities={},this.options=r(s)}parse(s,e){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const l=a.validate(s,e);if(l!==!0)throw Error(`${l.err.msg}:${l.err.line}:${l.err.col}`)}const i=new t(this.options);i.addExternalEntities(this.externalEntities);const c=i.parseXml(s);return this.options.preserveOrder||c===void 0?c:n(c,this.options)}addEntity(s,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=e}}return te=f,te}var re,Pe;function ft(){if(Pe)return re;Pe=1;const r=`
`;function t(e,i){let c="";return i.format&&i.indentBy.length>0&&(c=r),n(e,i,"",c)}function n(e,i,c,l){let h="",m=!1;if(!Array.isArray(e)){if(e!=null){let E=e.toString();return E=s(E,i),E}return""}for(let E=0;E<e.length;E++){const C=e[E],I=a(C);if(I===void 0)continue;let R="";if(c.length===0?R=I:R=`${c}.${I}`,I===i.textNodeName){let P=C[I];g(R,i)||(P=i.tagValueProcessor(I,P),P=s(P,i)),m&&(h+=l),h+=P,m=!1;continue}else if(I===i.cdataPropName){m&&(h+=l),h+=`<![CDATA[${C[I][0][i.textNodeName]}]]>`,m=!1;continue}else if(I===i.commentPropName){h+=l+`<!--${C[I][0][i.textNodeName]}-->`,m=!0;continue}else if(I[0]==="?"){const P=f(C[":@"],i),o=I==="?xml"?"":l;let S=C[I][0][i.textNodeName];S=S.length!==0?" "+S:"",h+=o+`<${I}${S}${P}?>`,m=!0;continue}let u=l;u!==""&&(u+=i.indentBy);const d=f(C[":@"],i),T=l+`<${I}${d}`,A=n(C[I],i,R,u);i.unpairedTags.indexOf(I)!==-1?i.suppressUnpairedNode?h+=T+">":h+=T+"/>":(!A||A.length===0)&&i.suppressEmptyNode?h+=T+"/>":A&&A.endsWith(">")?h+=T+`>${A}${l}</${I}>`:(h+=T+">",A&&l!==""&&(A.includes("/>")||A.includes("</"))?h+=l+i.indentBy+A+l:h+=A,h+=`</${I}>`),m=!0}return h}function a(e){const i=Object.keys(e);for(let c=0;c<i.length;c++){const l=i[c];if(Object.prototype.hasOwnProperty.call(e,l)&&l!==":@")return l}}function f(e,i){let c="";if(e&&!i.ignoreAttributes)for(let l in e){if(!Object.prototype.hasOwnProperty.call(e,l))continue;let h=i.attributeValueProcessor(l,e[l]);h=s(h,i),h===!0&&i.suppressBooleanAttributes?c+=` ${l.substr(i.attributeNamePrefix.length)}`:c+=` ${l.substr(i.attributeNamePrefix.length)}="${h}"`}return c}function g(e,i){e=e.substr(0,e.length-i.textNodeName.length-1);let c=e.substr(e.lastIndexOf(".")+1);for(let l in i.stopNodes)if(i.stopNodes[l]===e||i.stopNodes[l]==="*."+c)return!0;return!1}function s(e,i){if(e&&e.length>0&&i.processEntities)for(let c=0;c<i.entities.length;c++){const l=i.entities[c];e=e.replace(l.regex,l.val)}return e}return re=t,re}var se,Ae;function dt(){if(Ae)return se;Ae=1;const r=ft(),t=qe(),n={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,i){return i},attributeValueProcessor:function(e,i){return i},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(e){this.options=Object.assign({},n,e),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=t(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=f,this.options.format?(this.indentate=g,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}a.prototype.build=function(e){return this.options.preserveOrder?r(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},a.prototype.j2x=function(e,i,c){let l="",h="";const m=c.join(".");for(let E in e)if(Object.prototype.hasOwnProperty.call(e,E))if(typeof e[E]>"u")this.isAttribute(E)&&(h+="");else if(e[E]===null)this.isAttribute(E)||E===this.options.cdataPropName?h+="":E[0]==="?"?h+=this.indentate(i)+"<"+E+"?"+this.tagEndChar:h+=this.indentate(i)+"<"+E+"/"+this.tagEndChar;else if(e[E]instanceof Date)h+=this.buildTextValNode(e[E],E,"",i);else if(typeof e[E]!="object"){const C=this.isAttribute(E);if(C&&!this.ignoreAttributesFn(C,m))l+=this.buildAttrPairStr(C,""+e[E]);else if(!C)if(E===this.options.textNodeName){let I=this.options.tagValueProcessor(E,""+e[E]);h+=this.replaceEntitiesValue(I)}else h+=this.buildTextValNode(e[E],E,"",i)}else if(Array.isArray(e[E])){const C=e[E].length;let I="",R="";for(let u=0;u<C;u++){const d=e[E][u];if(!(typeof d>"u"))if(d===null)E[0]==="?"?h+=this.indentate(i)+"<"+E+"?"+this.tagEndChar:h+=this.indentate(i)+"<"+E+"/"+this.tagEndChar;else if(typeof d=="object")if(this.options.oneListGroup){const T=this.j2x(d,i+1,c.concat(E));I+=T.val,this.options.attributesGroupName&&d.hasOwnProperty(this.options.attributesGroupName)&&(R+=T.attrStr)}else I+=this.processTextOrObjNode(d,E,i,c);else if(this.options.oneListGroup){let T=this.options.tagValueProcessor(E,d);T=this.replaceEntitiesValue(T),I+=T}else I+=this.buildTextValNode(d,E,"",i)}this.options.oneListGroup&&(I=this.buildObjectNode(I,E,R,i)),h+=I}else if(this.options.attributesGroupName&&E===this.options.attributesGroupName){const C=Object.keys(e[E]),I=C.length;for(let R=0;R<I;R++)l+=this.buildAttrPairStr(C[R],""+e[E][C[R]])}else h+=this.processTextOrObjNode(e[E],E,i,c);return{attrStr:l,val:h}},a.prototype.buildAttrPairStr=function(e,i){return i=this.options.attributeValueProcessor(e,""+i),i=this.replaceEntitiesValue(i),this.options.suppressBooleanAttributes&&i==="true"?" "+e:" "+e+'="'+i+'"'};function f(e,i,c,l){const h=this.j2x(e,c+1,l.concat(i));return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],i,h.attrStr,c):this.buildObjectNode(h.val,i,h.attrStr,c)}a.prototype.buildObjectNode=function(e,i,c,l){if(e==="")return i[0]==="?"?this.indentate(l)+"<"+i+c+"?"+this.tagEndChar:this.indentate(l)+"<"+i+c+this.closeTag(i)+this.tagEndChar;{let h="</"+i+this.tagEndChar,m="";return i[0]==="?"&&(m="?",h=""),(c||c==="")&&e.indexOf("<")===-1?this.indentate(l)+"<"+i+c+m+">"+e+h:this.options.commentPropName!==!1&&i===this.options.commentPropName&&m.length===0?this.indentate(l)+`<!--${e}-->`+this.newLine:this.indentate(l)+"<"+i+c+m+this.tagEndChar+e+this.indentate(l)+h}},a.prototype.closeTag=function(e){let i="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(i="/"):this.options.suppressEmptyNode?i="/":i=`></${e}`,i},a.prototype.buildTextValNode=function(e,i,c,l){if(this.options.cdataPropName!==!1&&i===this.options.cdataPropName)return this.indentate(l)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&i===this.options.commentPropName)return this.indentate(l)+`<!--${e}-->`+this.newLine;if(i[0]==="?")return this.indentate(l)+"<"+i+c+"?"+this.tagEndChar;{let h=this.options.tagValueProcessor(i,e);return h=this.replaceEntitiesValue(h),h===""?this.indentate(l)+"<"+i+c+this.closeTag(i)+this.tagEndChar:this.indentate(l)+"<"+i+c+">"+h+"</"+i+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let i=0;i<this.options.entities.length;i++){const c=this.options.entities[i];e=e.replace(c.regex,c.val)}return e};function g(e){return this.options.indentBy.repeat(e)}function s(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}return se=a,se}var ne,Oe;function lt(){if(Oe)return ne;Oe=1;const r=Ue(),t=ct(),n=dt();return ne={XMLParser:t,XMLValidator:r,XMLBuilder:n},ne}var ht=lt();function Re(r,t){if(t?._parser&&t._parser!=="fast-xml-parser")throw new Error(t?._parser);const n={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t?.removeNSPrefix,textNodeName:t?.textNodeName,isArray:(f,g,s,e)=>!!t?.arrayPaths?.some(c=>g===c),...t?._fastXML},a=pt(r,n);return t?.uncapitalizeKeys?ae(a):a}function pt(r,t){return new ht.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(r)}const gt="4.3.3",U={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:gt,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:mt,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(r,t)=>Re(new TextDecoder().decode(r),{...U.options.xml,...t?.xml}),parseTextSync:(r,t)=>Re(r,{...U.options.xml,...t?.xml})};function mt(r){return r.startsWith("<?xml")}function yt(r,t){const n=U.parseTextSync?.(r,t),a=n?.ServiceExceptionReport?.ServiceException||n?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof a=="string"?a:a.value||a.code||"Unknown error"}const bt="4.3.3",k={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:bt,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Et,options:{wms:{throwOnError:!1}},parse:async(r,t)=>ie(new TextDecoder().decode(r),t),parseSync:(r,t)=>ie(new TextDecoder().decode(r),t),parseTextSync:(r,t)=>ie(r,t)};function Et(r){return r.startsWith("<?xml")}function ie(r,t){const n={...k.options.wms,...t?.wms},a=yt(r,n),f=n.minimalErrors?a:`WMS Service error: ${a}`;if(n.throwOnError)throw new Error(f);return f}function q(r){return Array.isArray(r)?r:r?[r]:[]}function G(r){const t=q(r);return t.length>0&&t.every(n=>typeof n=="string")?t:[]}function W(r,t=void 0){switch(typeof r){case"number":return r;case"string":return parseFloat(r);default:return}}function oe(r,t=void 0){switch(typeof r){case"number":return r;case"string":return parseInt(r,10);default:return}}function V(r){switch(r){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function Me(r,t){const n=U.parseTextSync?.(r,t),a=n.WMT_MS_Capabilities||n.WMS_Capabilities||n,f=wt(a);if(t?.inheritedLayerProps)for(const g of f.layers)We(g,null);return t?.includeRawJSON&&(f.json=a),t?.includeXMLText&&(f.xml=r),f}function wt(r){const t={version:String(r.version||""),name:String(r.Service?.Name||"unnamed"),title:r.Service?.Title?String(r.Service?.Title):void 0,abstract:r.Service?.Abstract?String(r.Service?.Abstract):void 0,keywords:G(r.Service?.KeywordList?.Keyword),fees:r.Service?.Fees?JSON.stringify(r.Service?.Fees):void 0,accessConstraints:r.Service?.AccessConstraints?JSON.stringify(r.Service?.AccessConstraints):void 0,layerLimit:oe(r.Service?.LayerLimit),maxWidth:oe(r.Service?.maxWidth),maxHeight:oe(r.Service?.maxHeight),layers:[],requests:Nt(r.Capability?.Request),exceptions:Tt(r.Exception)},n=q(r.Capability?.Layer);for(const a of n)t.layers.push(Xe(a));for(const[a,f]of Object.entries(t))f===void 0&&delete t[a];return t}function Nt(r){const t={};for(const[n,a]of Object.entries(r||{})){const f=G(a?.Format);t[n]={mimeTypes:f}}return t}function Tt(r){if(q(r?.Format).length>0)return{mimeTypes:G(r)}}function Xe(r){const t={title:String(r?.Title||""),name:r?.Name&&String(r?.Name),abstract:r?.Name&&String(r?.Abstract),keywords:G(r.KeywordList?.Keyword)},n=r?.CRS||r?.SRS;n&&Array.isArray(n)&&n.every(c=>typeof c=="string")&&(t.crs=n);let a=r?.EX_GeographicBoundingBox&&St(r?.EX_GeographicBoundingBox);a&&(t.geographicBoundingBox=a),a=r?.LatLonBoundingBox&&xt(r?.LatLonBoundingBox),a&&(t.geographicBoundingBox=a);const f=r?.BoundingBox&&It(r?.BoundingBox);f&&f.length>0&&(t.boundingBoxes=f);const s=q(r?.Dimension).map(c=>Ct(c));s.length&&(t.dimensions=s),r?.opaque&&(t.opaque=V(r?.opaque)),r?.cascaded&&(t.cascaded=V(r?.cascaded)),r?.queryable&&(t.queryable=V(r?.queryable));const e=q(r?.Layer),i=[];for(const c of e)i.push(Xe(c));i.length>0&&(t.layers=i);for(const[c,l]of Object.entries(t))l===void 0&&delete t[c];return t}function St(r){const{westBoundLongitude:t,northBoundLatitude:n,eastBoundLongitude:a,southBoundLatitude:f}=r;return[[t,f],[a,n]]}function xt(r){const{minx:t,miny:n,maxx:a,maxy:f}=r;return[[t,n],[a,f]]}function It(r){return q(r).map(n=>Lt(n))}function Lt(r){const{CRS:t,SRS:n,minx:a,miny:f,maxx:g,maxy:s,resx:e,resy:i}=r,c={crs:t||n,boundingBox:[[W(a),W(f)],[W(g),W(s)]]};return e&&(c.xResolution=e),i&&(c.yResolution=i),c}function Ct(r){const{name:t,units:n,value:a}=r,f={name:t,units:n,extent:a};return r.unitSymbol&&(f.unitSymbol=r.unitSymbol),r.default&&(f.defaultValue=r.default),r.multipleValues&&(f.multipleValues=V(r.multipleValues)),r.nearestValue&&(f.nearestValue=V(r.nearestValue)),r.current&&(f.current=V(r.current)),f}function We(r,t){t?.geographicBoundingBox&&!r.geographicBoundingBox&&(r.geographicBoundingBox=[...t.geographicBoundingBox]),t?.crs&&!r.crs&&(r.crs=[...t.crs]),t?.boundingBoxes&&!r.boundingBoxes&&(r.boundingBoxes=[...t.boundingBoxes]),t?.dimensions&&!r.dimensions&&(r.dimensions=[...t.dimensions]);for(const n of r.layers||[])We(n,r)}const vt="4.3.3",de={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:vt,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Pt,options:{wms:{}},parse:async(r,t)=>Me(new TextDecoder().decode(r),t?.wms),parseTextSync:(r,t)=>Me(r,t?.wms)};function Pt(r){return r.startsWith("<?xml")}function Be(r,t){const a=(U.parseTextSync?.(r,t)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(a)?a:[a]).map(g=>At(g))}}function At(r){return{attributes:r||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const Ot={...de,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(r,t)=>Be(new TextDecoder().decode(r),t),parseTextSync:(r,t)=>Be(r,t)};function _e(r,t){return U.parseTextSync?.(r,t)}const Rt={...de,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(r,t)=>_e(new TextDecoder().decode(r),t),parseTextSync:(r,t)=>_e(r,t)},Mt={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:r=>r.toLowerCase().includes("wms"),createDataSource:(r,t)=>new Bt(r,t)};class Bt extends ce{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(t,n){super(n),this.url=t,this.data=t,this.substituteCRS84=n.wms?.substituteCRS84??n.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...n.wmsParameters,...n.wms?.wmsParameters},this.vendorParameters=n.wms?.vendorParameters||n.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:n,bbox:a,...f}=t,g={bbox:n?[...n[0],...n[1]]:a,...f};return await this.getMap(g)}normalizeMetadata(t){return t}async getCapabilities(t,n){const a=this.getCapabilitiesURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();this._checkResponse(f,g);const s=await de.parse(g,this.loadOptions);return this.capabilities=s,s}async getMap(t,n){const a=this.getMapURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();this._checkResponse(f,g);try{return await ye.parse(g,this.loadOptions)}catch{throw this._parseError(g)}}async getFeatureInfo(t,n){const a=this.getFeatureInfoURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();return this._checkResponse(f,g),await Ot.parse(g,this.loadOptions)}async getFeatureInfoText(t,n){const a=this.getFeatureInfoURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();return this._checkResponse(f,g),new TextDecoder().decode(g)}async describeLayer(t,n){const a=this.describeLayerURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();return this._checkResponse(f,g),await Rt.parse(g,this.loadOptions)}async getLegendGraphic(t,n){const a=this.getLegendGraphicURL(t,n),f=await this.fetch(a),g=await f.arrayBuffer();this._checkResponse(f,g);try{return await ye.parse(g,this.loadOptions)}catch{throw this._parseError(g)}}getCapabilitiesURL(t,n){const a={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",a,n)}getMapURL(t,n){t=this._getWMS130Parameters(t);const a={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",a,n)}getFeatureInfoURL(t,n){t=this._getWMS130Parameters(t);const{boundingBox:a,bbox:f}=t;t.bbox=a?[...a[0],...a[1]]:f;const g={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",g,n)}describeLayerURL(t,n){const a={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",a,n)}getLegendGraphicURL(t,n){const a={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",a,n)}_parseWMSUrl(t){const[n,a]=t.split("?"),f=a.split("&"),g={};for(const s of f){const[e,i]=s.split("=");g[e]=i}return{url:n,parameters:g}}_getWMSUrl(t,n,a){let f=this.url,g=!0;const s={service:"WMS",version:n.version,request:t,...n,...this.vendorParameters,...a},e=["transparent","time","elevation"];for(const[i,c]of Object.entries(s))(!e.includes(i)||c)&&(f+=g?"?":"&",g=!1,f+=this._getURLParameter(i,c,n));return encodeURI(f)}_getWMS130Parameters(t){const n={...t};return n.srs&&(n.crs=n.crs||n.srs,delete n.srs),n}_getURLParameter(t,n,a){switch(t){case"crs":a.version!=="1.3.0"?t="srs":this.substituteCRS84&&n==="EPSG:4326"&&(n="CRS:84");break;case"srs":a.version==="1.3.0"&&(t="crs");break;case"bbox":const f=this._flipBoundingBox(n,a);f&&(n=f);break;case"x":a.version==="1.3.0"&&(t="i");break;case"y":a.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(n)?`${t}=${n.join(",")}`:`${t}=${n?String(n):""}`}_flipBoundingBox(t,n){if(!Array.isArray(t)||t.length!==4)return null;const a=n.version==="1.3.0"&&this.flipCRS.includes(n.crs||"")&&!(this.substituteCRS84&&n.crs==="EPSG:4326"),f=t;return a?[f[1],f[0],f[3],f[2]]:f}async _fetchArrayBuffer(t){const n=await this.fetch(t),a=await n.arrayBuffer();return this._checkResponse(n,a),a}_checkResponse(t,n){const a=t.headers["content-type"];if(!t.ok||k.mimeTypes.includes(a)){const f=Ke(this.loadOptions,{wms:{throwOnError:!0}}),g=k.parseSync?.(n,f);throw new Error(g)}}_parseError(t){const n=k.parseSync?.(t,this.loadOptions);return new Error(n)}}const _t={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:r=>r.toLowerCase().includes("ImageServer"),createDataSource:(r,t)=>new Ft(r,t)};class Ft extends ce{url;data;constructor(t,n){super(n),this.url=t,this.data=t}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.url}?f=pjson`}exportImageURL(t){const n=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,a=`size=${t.width},${t.height}`,f={...t,bbox:n,size:a};return delete f.width,delete f.height,this.getUrl("exportImage",f)}getUrl(t,n,a){let f=`${this.url}/${t}`,g=!0;for(const[s,e]of Object.entries(n))f+=g?"?":"&",g=!1,Array.isArray(e)?f+=`${s.toUpperCase()}=${e.join(",")}`:f+=`${s.toUpperCase()}=${e?String(e):""}`;return f}async checkResponse(t){if(!t.ok)throw new Error("error")}}const Vt=[Mt,_t];function $t(r,t=Vt){const{type:n="auto"}=r,a=n==="auto"?qt(r.url,t):Ut(n,t);if(!a)throw new Error("Not a valid image source type");return a.createDataSource(r.url,r)}function Ut(r,t){for(const n of t)if(n.type===r)return n;return null}function qt(r,t){for(const n of t)if(n.testURL&&n.testURL(r))return n;return null}const Fe=6378137*Math.PI;function Ve(r){const t=je(r);return t[0]=(t[0]/256-1)*Fe,t[1]=(t[1]/256-1)*Fe,t}const Xt={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(r,t)=>console.error(t,r)}};class le extends Qe{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:n,oldProps:a}){const{viewport:f}=this.context;t.dataChanged||n.serviceType!==a.serviceType?(this.state.imageSource=this._createImageSource(n),this._loadMetadata(),this.debounce(()=>this.loadImage(f,"image source changed"),0)):Ze(n.layers,a.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(f,"viewport changed")):this.debounce(()=>this.loadImage(f,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:t,image:n,lastRequestParameters:a}=this.state;return n&&new De({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:a.srs==="EPSG:4326"?be.LNGLAT:be.CARTESIAN,bounds:t,image:n})}async getFeatureInfoText(t,n){const{lastRequestParameters:a}=this.state;return a?await this.state.imageSource.getFeatureInfoText?.({...a,query_layers:a.layers,x:t,y:n,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(t){if(t.data instanceof ce)return t.data;if(typeof t.data=="string")return $t({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:t}=this.state;try{this.state.loadCounter++;const n=await t.getMetadata();this.state.imageSource===t&&this.getCurrentLayer()?.props.onMetadataLoad(n)}catch(n){this.getCurrentLayer()?.props.onMetadataLoadError(n)}finally{this.state.loadCounter--}}async loadImage(t,n){const{layers:a,serviceType:f}=this.props;if(f==="wms"&&a.length===0)return;const g=t.getBounds(),{width:s,height:e}=t,i=this.getRequestId();let{srs:c}=this.props;c==="auto"&&(c=t.resolution?"EPSG:4326":"EPSG:3857");const l={width:s,height:e,boundingBox:[[g[0],g[1]],[g[2],g[3]]],layers:a,crs:c};if(c==="EPSG:3857"){const h=Ve([g[0],g[1]]),m=Ve([g[2],g[3]]);l.boundingBox=[h,m]}try{this.state.loadCounter++,this.props.onImageLoadStart(i);const h=await this.state.imageSource.getImage(l);this.state.lastRequestId<i&&(this.getCurrentLayer()?.props.onImageLoad(i),this.setState({image:h,bounds:g,lastRequestParameters:l,lastRequestId:i}))}catch(h){this.raiseError(h,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(i,h)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,n=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),n)}}le.layerName="WMSLayer";le.defaultProps=Xt;const $=new ue.Map({container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[-95,40],zoom:4});$.addControl(new ue.NavigationControl,"top-right");$.addControl(new ue.ScaleControl({unit:"metric"}),"bottom-right");const he=new He({layers:[]}),pe=new Map,ke=new Je($,he,pe);let Ge=.8;function Wt(){he.setProps({layers:Array.from(pe.values())})}function ze(){const r="wms-layer",t=new le({id:r,data:"https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",serviceType:"wms",layers:["nexrad-n0r"],opacity:Ge});pe.set(r,t),Wt(),ke.notifyLayerAdded(r)}const $e=document.getElementById("opacity"),kt=document.getElementById("opacityValue");$e?.addEventListener("input",()=>{const r=parseInt($e.value,10);kt.textContent=`${r}%`,Ge=r/100,ze()});$.on("load",()=>{$.addControl(he);const r=new Ye({collapsed:!0,customLayerAdapters:[ke],panelWidth:360});$.addControl(r,"top-right"),ze()});
