import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{h as v}from"./maplibre-gl-C9tqRo8a.js";import{L as H}from"./maplibre-gl-layer-control-CbPNLzzp.js";import{D as Z}from"./DeckLayerAdapter-kz44PQGX.js";import{a2 as U,l as T,$ as K,C as $,d as q,M as Y}from"./mapbox-overlay-CjL5nCza.js";import{T as D,i as Q,g as X,a as ee,u as te}from"./tile-layer-C-vhnqxm.js";import{G as j}from"./geojson-layer-Bt5D6tt8.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./preload-helper-PPVm8Dsz.js";import"./composite-layer-dQcQCi_n.js";import"./bounding-box-from-points-Ddk0fpRK.js";import"./quaternion-CNi4xXkd.js";import"./utils-2CUC2toc.js";import"./icon-layer-BEyd8eAL.js";import"./picking-CN0D5Hbh.js";import"./geometry-U_tfiUzx.js";import"./scatterplot-layer-D0wjM0aN.js";import"./color-CUNNsFV-.js";import"./text-layer-BBGR-Bob.js";import"./path-layer-BtOBY6v6.js";import"./cut-by-mercator-bounds-BgqYccvj.js";import"./solid-polygon-layer-DvkMDu8v.js";import"./polygon-utils-B8iYQ3Og.js";import"./gouraud-material-DpEoe11x.js";import"./lighting-Vr4zHQkI.js";import"./phong-shaders-wgsl-3FV41e28.js";class b{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&U(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,o={updateTriggers:{}};for(const i in t)if(i in this.props){const r=t[i],s=this.props[i];o[i]=s,r&&r.type==="accessor"&&(o.updateTriggers[i]=this.props.updateTriggers[i],typeof s=="function"&&(o[i]=this.getSubLayerAccessor(s)))}return o}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}b.defaultProps={};b.extensionName="LayerExtension";const ne={clipBounds:[0,0,1,1],clipByInstance:void 0},M=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,oe={name:"clip",vs:M,uniformTypes:{bounds:"vec4<f32>"}},ie={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},re={name:"clip",fs:M,uniformTypes:{bounds:"vec4<f32>"}},se={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class x extends b{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[oe],inject:ie}:{modules:[re],inject:se}}draw(){const{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{const o=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(o[0],i[0]),Math.min(o[1],i[1]),Math.max(o[0],i[0]),Math.max(o[1],i[1])]}this.setShaderModuleProps({clip:t})}}x.defaultProps=ne;x.extensionName="ClipExtension";function _(n,e){const t=e?.globalFeatureId;return t!==void 0?ae(n,t):le(n,e?.type)}function ae(n,e){const t=G(n);for(const o of t){let i=0,r=o.featureIds.value[0];for(let s=0;s<o.featureIds.value.length;s++){const l=o.featureIds.value[s];if(l!==r){if(e===o.globalFeatureIds.value[i])return f(o,i,s);i=s,r=l}}if(e===o.globalFeatureIds.value[i])return f(o,i,o.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function le(n,e){const t=G(n);return ue(t)}function ce(n,e,t){switch(n.type){case"Point":return he(n,e,t);case"LineString":return fe(n,e,t);case"Polygon":return E(n,e,t);default:const o=n;throw new Error(`Unsupported geometry type: ${o?.type}`)}}function G(n,e){const t=[];return n.points&&(n.points.type="Point",t.push(n.points)),n.lines&&(n.lines.type="LineString",t.push(n.lines)),n.polygons&&(n.polygons.type="Polygon",t.push(n.polygons)),t}function ue(n){const e=[];for(const t of n){if(t.featureIds.value.length===0)continue;let o=0,i=t.featureIds.value[0];for(let r=0;r<t.featureIds.value.length;r++){const s=t.featureIds.value[r];s!==i&&(e.push(f(t,o,r)),o=r,i=s)}e.push(f(t,o,t.featureIds.value.length))}return e}function f(n,e,t){const o=ce(n,e,t),i=de(n,e),r=pe(n,e);return{type:"Feature",geometry:o,properties:i,...r}}function pe(n,e=0,t){return n.fields&&n.fields[n.featureIds.value[e]]}function de(n,e=0,t){const o=Object.assign({},n.properties[n.featureIds.value[e]]);for(const i in n.numericProps)o[i]=n.numericProps[i].value[e];return o}function E(n,e=-1/0,t=1/0){const{positions:o}=n,i=n.polygonIndices.value.filter(a=>a>=e&&a<=t),r=n.primitivePolygonIndices.value.filter(a=>a>=e&&a<=t);if(!(i.length>2)){const a=[];for(let c=0;c<r.length-1;c++){const u=r[c],p=r[c+1],y=h(o,u,p);a.push(y)}return{type:"Polygon",coordinates:a}}const l=[];for(let a=0;a<i.length-1;a++){const c=i[a],u=i[a+1],p=E(n,c,u).coordinates;l.push(p)}return{type:"MultiPolygon",coordinates:l}}function fe(n,e=-1/0,t=1/0){const{positions:o}=n,i=n.pathIndices.value.filter(l=>l>=e&&l<=t);if(!(i.length>2))return{type:"LineString",coordinates:h(o,i[0],i[1])};const s=[];for(let l=0;l<i.length-1;l++){const a=h(o,i[l],i[l+1]);s.push(a)}return{type:"MultiLineString",coordinates:s}}function he(n,e,t){const{positions:o}=n,i=h(o,e,t);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function h(n,e,t){e=e||0,t=t||n.value.length/n.size;const o=[];for(let i=e;i<t;i++){const r=Array();for(let s=i*n.size;s<(i+1)*n.size;s++)r.push(Number(n.value[s]));o.push(r)}return o}const ye="4.3.3",B={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:ye,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...B});const me={Point:A,MultiPoint:ge,LineString:k,MultiLineString:Ie,Polygon:R,MultiPolygon:ve};function A([n,e],[t,o],i){const r=T(t[0],o[0],n),s=T(t[1],o[1],e);return i.unprojectFlat([r,s])}function L(n,e,t){return n.map(o=>A(o,e,t))}function ge(n,e,t){return L(n,e,t)}function k(n,e,t){return L(n,e,t)}function Ie(n,e,t){return n.map(o=>k(o,e,t))}function R(n,e,t){return n.map(o=>L(o,e,t))}function ve(n,e,t){return n.map(o=>R(o,e,t))}function be(n,e,t){const o=t.projectFlat([e.west,e.north]),i=t.projectFlat([e.east,e.south]),r=[o,i];return{...n,coordinates:me[n.type](n.coordinates,r,t)}}const xe=["points","lines","polygons"];function Le(n,e,t,o){for(const i of xe){const r=n[i]&&Se(n[i],e,t,o);if(r>=0)return r}return-1}function Se(n,e,t,o){const i=n.featureIds.value;if(!i.length)return-1;let r=0,s=i[i.length-1]+1;if(o){const a=Pe(n,o);if(a)r=a[0],s=a[1]+1;else return-1}let l=-1;if(e in n.numericProps){const a=n.numericProps[e].value.findIndex((c,u)=>c===t&&i[u]>=r&&i[u]<s);return a>=0?n.globalFeatureIds.value[a]:-1}else e?l=w(n.properties,a=>a[e]===t,r,s):n.fields&&(l=w(n.fields,a=>a.id===t,r,s));return l>=0?Fe(n,l):-1}function Pe(n,e){if(!n.__layers){const t={},{properties:o}=n;for(let i=0;i<o.length;i++){const{layerName:r}=o[i];r&&(t[r]?t[r][1]=i:t[r]=[i,i])}n.__layers=t}return n.__layers[e]}function Fe(n,e){if(!n.__ids){const t=[],o=n.featureIds.value,i=n.globalFeatureIds.value;for(let r=0;r<o.length;r++)t[o[r]]=i[r];n.__ids=t}return n.__ids[e]}function w(n,e,t,o){for(let i=t;i<o;i++)if(e(n[i],i))return i;return-1}const m=512,Te={...j.defaultProps,data:te,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[B],binary:!0};class S extends D{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:o,changeFlags:i}){i.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:t,context:o,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:r}=e;r!==t.highlightColor&&Array.isArray(r)&&this.setState({highlightColor:r})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!Q(e)){const{onDataLoad:o,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{t=await i(e,{propName:"data",layer:this,loaders:[]})}catch(r){this.raiseError(r,"loading TileJSON"),e=null}o&&o(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:o,maxZoom:i}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>o&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(i)||t.maxzoom<i)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){const{data:t,binary:o}=this.state,{index:i,signal:r}=e,s=X(t,e);if(!s)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:a}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...l?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:o?{format:"binary"}:{}},a(s,{propName:"data",layer:this,loadOptions:l,signal:r})}renderSubLayers(e){const{x:t,y:o,z:i}=e.tile.index,r=Math.pow(2,i),s=m/r,l=-s,a=m*t/r,c=m*(1-o/r),u=new K().scale([s,l,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=u,e.coordinateOrigin=[a,c,0],e.coordinateSystem=$.CARTESIAN,e.extensions=[...e.extensions||[],new x]);const p=super.renderSubLayers(e);return this.state.binary&&!(p instanceof j)&&q.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),p}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:o,hoveredFeatureLayerName:i}=this.state,r=e.object;let s=null,l=null;r&&(s=g(r,t),l=O(r));let{highlightColor:a}=this.props;typeof a=="function"&&(a=a(e)),(o!==s||i!==l)&&this.setState({highlightColor:a,hoveredFeatureId:s,hoveredFeatureLayerName:l})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){const{data:o}=e.sourceLayer.props;t.object=_(o,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=C(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:o,binary:i}=this.state,{uniqueIdProperty:r,highlightedFeatureId:s}=this.props,l=e.content,a=N(s);if(!(N(t)||a))return-1;const u=a?s:t;return Array.isArray(l)?l.findIndex(p=>{const y=g(p,r)===u,J=a||O(p)===o;return y&&J}):l&&i?Le(l,r,u,a?"":o):-1}_pickObjects(e){const{deck:t,viewport:o}=this.context,i=o.width,r=o.height,s=o.x,l=o.y,a=[this.id];return t.pickObjects({x:s,y:l,width:i,height:r,layerIds:a,maxObjects:e})}getRenderedFeatures(e=null){const t=this._pickObjects(e),o=new Set,i=[];for(const r of t){const s=g(r.object,this.props.uniqueIdProperty);s===void 0?i.push(r.object):o.has(s)||(o.add(s),i.push(r.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(o=>{o.hasOwnProperty(e)||Object.defineProperty(o,e,{get:()=>{if(!o.content)return null;if(this.state.binary&&Array.isArray(o.content)&&!o.content.length)return[];const{bbox:i}=o;if(o._contentWGS84===void 0&&ee(i)){const r=this.state.binary?_(o.content):o.content;o._contentWGS84=r.map(s=>C(s,i,this.context.viewport))}return o._contentWGS84}})})}}S.layerName="MVTLayer";S.defaultProps=Te;function g(n,e){if(n.properties&&e)return n.properties[e];if("id"in n)return n.id}function O(n){return n.properties?.layerName||null}function N(n){return n!=null&&n!==""}function C(n,e,t){const o={...n,geometry:{type:n.geometry.type}};return Object.defineProperty(o.geometry,"coordinates",{get:()=>be(n.geometry,e,t).coordinates}),o}const d=new v.Map({container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[-122.4,37.8],zoom:11});d.addControl(new v.NavigationControl,"top-right");d.addControl(new v.ScaleControl({unit:"metric"}),"bottom-right");const P=new Y({layers:[]}),F=new Map,V=new Z(d,P,F);let z=1;function _e(){P.setProps({layers:Array.from(F.values())})}function W(){const n="mvt-layer",e=new S({id:n,data:"https://tiles.basemaps.cartocdn.com/vectortiles/carto.streets/v1/{z}/{x}/{y}.mvt",minZoom:0,maxZoom:14,getLineColor:[255,255,255,200],getFillColor:[100,130,180,100],getLineWidth:z,lineWidthMinPixels:1,pickable:!0});F.set(n,e),_e(),V.notifyLayerAdded(n)}const I=document.getElementById("lineWidth"),we=document.getElementById("widthValue");I?.addEventListener("input",()=>{z=parseInt(I.value,10),we.textContent=I.value,W()});d.on("load",()=>{d.addControl(P);const n=new H({collapsed:!0,customLayerAdapters:[V],panelWidth:360});d.addControl(n,"top-right"),W()});
