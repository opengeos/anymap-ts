const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BZ4mMa7o.js","./index-Du0sVlOV.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./preload-helper-PPVm8Dsz.js";class c{_shpjs=null;_initialized=!1;isReady(){return this._initialized&&this._shpjs!==null}async initialize(a){if(!this._initialized){a?.({stage:"initializing",percent:0,message:"Loading shapefile parser..."});try{this._shpjs=await g(()=>import("./index-BZ4mMa7o.js"),__vite__mapDeps([0,1]),import.meta.url),this._initialized=!0,a?.({stage:"initializing",percent:100,message:"Shapefile parser ready"})}catch{throw new Error("shpjs is not installed. Install it with: npm install shpjs")}}}async convert(a,o,s){const l=performance.now();this.isReady()||await this.initialize(s),s?.({stage:"loading",percent:10,message:`Loading ${o}...`});try{s?.({stage:"converting",percent:30,message:"Parsing shapefile..."});const e=await(this._shpjs.default||this._shpjs)(a);s?.({stage:"converting",percent:80,message:"Building feature collection..."});let t;Array.isArray(e)?t={type:"FeatureCollection",features:e.flatMap(i=>i.features||[])}:e.type==="FeatureCollection"?t=e:e.type==="Feature"?t={type:"FeatureCollection",features:[e]}:t={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};const n=new Set;for(const i of t.features)i.geometry&&n.add(i.geometry.type);const p=performance.now(),h={originalFormat:"shapefile",featureCount:t.features.length,geometryTypes:Array.from(n),fileSize:a.byteLength,conversionTimeMs:Math.round(p-l)};return s?.({stage:"complete",percent:100,message:`Converted ${t.features.length} features`}),{geojson:t,warnings:[],metadata:h}}catch(e){throw s?.({stage:"error",message:`Failed to parse shapefile: ${e instanceof Error?e.message:"Unknown error"}`}),e}}dispose(){this._shpjs=null,this._initialized=!1}}let r=null;function m(){return r||(r=new c),r}export{c as ShapefileConverter,m as getShapefileConverter};
