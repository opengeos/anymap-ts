const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-DUslI1gr-CHWxYEjV.js","./preload-helper-PPVm8Dsz.js","./maplibre-control-grid-CjAwM7R6.js","./modulepreload-polyfill-B5Qt9EMX.js","./maplibre-gl-C9tqRo8a.js","./_commonjsHelpers-Cpj98o6Y.js","./maplibre-gl-layer-control-CbPNLzzp.js","./maplibre-gl-layer-control-B2B1lUgE.css","./maplibre-control-grid-B7fJK_si.css","./styles-BIBrycxJ.css","./lzw-BZniWIYG-DcfKN2jV.js","./jpeg-CF9OGQg_-CuJhT80K.js","./deflate-BA1jZeSX-DgczRPj8.js","./pako.esm-Bx5X36Wo-BPBy5qxy.js","./packbits-DWY5O-FG-CluKezWp.js","./lerc-7LlQoT6u-Dbev0hlf.js","./webimage-ibSPOLHJ-CZqcyNLK.js"])))=>i.map(i=>d[i]);
import{_ as k}from"./preload-helper-PPVm8Dsz.js";import{a6 as je}from"./maplibre-control-grid-CjAwM7R6.js";import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import"./maplibre-gl-C9tqRo8a.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./maplibre-gl-layer-control-CbPNLzzp.js";const X={};function A(r){return(e,...t)=>_t(r,e,t)}function z(r,e){return A(qe(r,e).get)}const{apply:_t,getOwnPropertyDescriptor:qe,getPrototypeOf:De,ownKeys:Ot}=Reflect,{iterator:J,toStringTag:Ct}=Symbol,Mt=Object,{create:Pe,defineProperty:Rt}=Mt,Gt=Array,Ft=Gt.prototype,We=Ft[J],Ut=A(We),$e=ArrayBuffer,kt=$e.prototype;z(kt,"byteLength");const ke=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;ke&&z(ke.prototype,"byteLength");const Ye=De(Uint8Array);Ye.from;const D=Ye.prototype;D[J];A(D.keys);A(D.values);A(D.entries);A(D.set);A(D.reverse);A(D.fill);A(D.copyWithin);A(D.sort);A(D.slice);A(D.subarray);z(D,"buffer");z(D,"byteOffset");z(D,"length");z(D,Ct);const Lt=Uint8Array,Xe=Uint16Array,_e=Uint32Array,Bt=Float32Array,Z=De([][J]()),Ze=A(Z.next),vt=A((function*(){})().next),Nt=De(Z),Kt=DataView.prototype,zt=A(Kt.getUint16),Oe=WeakMap,Je=Oe.prototype,Qe=A(Je.get),Vt=A(Je.set),et=new Oe,Ht=Pe(null,{next:{value:function(){const r=Qe(et,this);return Ze(r)}},[J]:{value:function(){return this}}});function jt(r){if(r[J]===We&&Z.next===Ze)return r;const e=Pe(Ht);return Vt(et,e,Ut(r)),e}const qt=new Oe,Wt=Pe(Nt,{next:{value:function(){const r=Qe(qt,this);return vt(r)},writable:!0,configurable:!0}});for(const r of Ot(Z))r!=="next"&&Rt(Wt,r,qe(Z,r));const tt=new $e(4),$t=new Bt(tt),Yt=new _e(tt),R=new Xe(512),G=new Lt(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(R[r]=0,R[r|256]=32768,G[r]=24,G[r|256]=24):e<-14?(R[r]=1024>>-e-14,R[r|256]=1024>>-e-14|32768,G[r]=-e-1,G[r|256]=-e-1):e<=15?(R[r]=e+15<<10,R[r|256]=e+15<<10|32768,G[r]=13,G[r|256]=13):e<128?(R[r]=31744,R[r|256]=64512,G[r]=24,G[r|256]=24):(R[r]=31744,R[r|256]=64512,G[r]=13,G[r|256]=13)}const Ce=new _e(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Ce[r]=e|t}for(let r=1024;r<2048;++r)Ce[r]=939524096+(r-1024<<13);const V=new _e(64);for(let r=1;r<31;++r)V[r]=r<<23;V[31]=1199570944;V[32]=2147483648;for(let r=33;r<63;++r)V[r]=2147483648+(r-32<<23);V[63]=3347054592;const rt=new Xe(64);for(let r=1;r<64;++r)r!==32&&(rt[r]=1024);function Xt(r){const e=r>>10;return Yt[0]=Ce[rt[e]+(r&1023)]+V[e],$t[0]}function it(r,e,...t){return Xt(zt(r,e,...jt(t)))}var ne={exports:{}},Le;function Zt(){if(Le)return ne.exports;Le=1;function r(e,t,i){const s=i&&i.debug||!1;s&&console.log("[xml-utils] getting "+t+" in "+e);const n=typeof e=="object"?e.outer:e,o=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let h=0;h<a.length;h++){const l=a[h],c=t+"\\="+l+"([^"+l+"]*)"+l;s&&console.log("[xml-utils] pattern:",c);const f=new RegExp(c).exec(o);if(s&&console.log("[xml-utils] match:",f),f)return f[1]}}return ne.exports=r,ne.exports.default=r,ne.exports}var Jt=Zt();const Ie=je(Jt);var oe={exports:{}},ae={exports:{}},le={exports:{}},Be;function Qt(){if(Be)return le.exports;Be=1;function r(e,t,i){const s=new RegExp(t).exec(e.slice(i));return s?i+s.index:-1}return le.exports=r,le.exports.default=r,le.exports}var he={exports:{}},ve;function er(){if(ve)return he.exports;ve=1;function r(e,t,i){const s=new RegExp(t).exec(e.slice(i));return s?i+s.index+s[0].length-1:-1}return he.exports=r,he.exports.default=r,he.exports}var ce={exports:{}},Ne;function tr(){if(Ne)return ce.exports;Ne=1;function r(e,t){const i=new RegExp(t,"g"),s=e.match(i);return s?s.length:0}return ce.exports=r,ce.exports.default=r,ce.exports}var Ke;function rr(){if(Ke)return ae.exports;Ke=1;const r=Qt(),e=er(),t=tr();function i(s,n,o){const a=o&&o.debug||!1,h=!(o&&typeof o.nested===!1),l=o&&o.startIndex||0;a&&console.log("[xml-utils] starting findTagByName with",n," and ",o);const c=r(s,`<${n}[ 
>/]`,l);if(a&&console.log("[xml-utils] start:",c),c===-1)return;const f=s.slice(c+n.length);let g=e(f,"^[^<]*[ /]>",0);const d=g!==-1&&f[g-1]==="/";if(a&&console.log("[xml-utils] selfClosing:",d),d===!1)if(h){let w=0,m=1,I=0;for(;(g=e(f,"[ /]"+n+">",w))!==-1;){const b=f.substring(w,g+1);if(m+=t(b,"<"+n+`[ 
	>]`),I+=t(b,"</"+n+">"),I>=m)break;w=g}}else g=e(f,"[ /]"+n+">",0);const u=c+n.length+g+1;if(a&&console.log("[xml-utils] end:",u),u===-1)return;const p=s.slice(c,u);let y;return d?y=null:y=p.slice(p.indexOf(">")+1,p.lastIndexOf("<")),{inner:y,outer:p,start:c,end:u}}return ae.exports=i,ae.exports.default=i,ae.exports}var ze;function ir(){if(ze)return oe.exports;ze=1;const r=rr();function e(t,i,s){const n=[],o=s&&s.debug||!1,a=s&&typeof s.nested=="boolean"?s.nested:!0;let h=s&&s.startIndex||0,l;for(;l=r(t,i,{debug:o,startIndex:h});)a?h=l.start+1+i.length:h=l.end,n.push(l);return o&&console.log("findTagsByName found",n.length,"tags"),n}return oe.exports=e,oe.exports.default=e,oe.exports}var sr=ir();const nr=je(sr),L={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},C={};for(const r in L)L.hasOwnProperty(r)&&(C[L[r]]=parseInt(r,10));const ge={256:"SHORT",257:"SHORT",258:"SHORT",259:"SHORT",262:"SHORT",273:"LONG",274:"SHORT",277:"SHORT",278:"LONG",279:"LONG",282:"RATIONAL",283:"RATIONAL",284:"SHORT",286:"SHORT",287:"RATIONAL",296:"SHORT",297:"SHORT",305:"ASCII",306:"ASCII",338:"SHORT",339:"SHORT",513:"LONG",514:"LONG",1024:"SHORT",1025:"SHORT",2048:"SHORT",2049:"ASCII",3072:"SHORT",3073:"ASCII",33550:"DOUBLE",33922:"DOUBLE",34264:"DOUBLE",34665:"LONG",34735:"SHORT",34736:"DOUBLE",34737:"ASCII",42113:"ASCII"},st=[C.BitsPerSample,C.ExtraSamples,C.SampleFormat,C.StripByteCounts,C.StripOffsets,C.StripRowCounts,C.TileByteCounts,C.TileOffsets,C.SubIFDs],Y={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},S={};for(const r in Y)Y.hasOwnProperty(r)&&(S[Y[r]]=parseInt(r,10));const _={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},nt={Unspecified:0,Assocalpha:1,Unassalpha:2},or={Version:0,AddCompression:1},ar={None:0,Deflate:1,Zstandard:2},N={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},ot={};for(const r in N)N.hasOwnProperty(r)&&(ot[N[r]]=parseInt(r,10));const lr=Object.freeze(Object.defineProperty({__proto__:null,ExtraSamplesValues:nt,LercAddCompression:ar,LercParameters:or,arrayFields:st,fieldTagNames:L,fieldTagTypes:ge,fieldTags:C,fieldTypeNames:Y,fieldTypes:S,geoKeyNames:N,geoKeys:ot,photometricInterpretations:_},Symbol.toStringTag,{value:"Module"}));function at(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3);let n;for(let o=0,a=0;o<r.length;++o,a+=3)n=256-r[o]/e*256,s[a]=n,s[a+1]=n,s[a+2]=n;return s}function lt(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3);let n;for(let o=0,a=0;o<r.length;++o,a+=3)n=r[o]/e*256,s[a]=n,s[a+1]=n,s[a+2]=n;return s}function ht(r,e){const{width:t,height:i}=r,s=new Uint8Array(t*i*3),n=e.length/3,o=e.length/3*2;for(let a=0,h=0;a<r.length;++a,h+=3){const l=r[a];s[h]=e[l]/65536*256,s[h+1]=e[l+n]/65536*256,s[h+2]=e[l+o]/65536*256}return s}function ct(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let s=0,n=0;s<r.length;s+=4,n+=3){const o=r[s],a=r[s+1],h=r[s+2],l=r[s+3];i[n]=255*((255-o)/256)*((255-l)/256),i[n+1]=255*((255-a)/256)*((255-l)/256),i[n+2]=255*((255-h)/256)*((255-l)/256)}return i}function ft(r){const{width:e,height:t}=r,i=new Uint8ClampedArray(e*t*3);for(let s=0,n=0;s<r.length;s+=3,n+=3){const o=r[s],a=r[s+1],h=r[s+2];i[n]=o+1.402*(h-128),i[n+1]=o-.34414*(a-128)-.71414*(h-128),i[n+2]=o+1.772*(a-128)}return i}const hr=.95047,cr=1,fr=1.08883;function ut(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let s=0,n=0;s<r.length;s+=3,n+=3){const o=r[s+0],a=r[s+1]<<24>>24,h=r[s+2]<<24>>24;let l=(o+16)/116,c=a/500+l,f=l-h/200,g,d,u;c=hr*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),l=cr*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),f=fr*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),g=c*3.2406+l*-1.5372+f*-.4986,d=c*-.9689+l*1.8758+f*.0415,u=c*.0557+l*-.204+f*1.057,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,i[n]=Math.max(0,Math.min(1,g))*255,i[n+1]=Math.max(0,Math.min(1,d))*255,i[n+2]=Math.max(0,Math.min(1,u))*255}return i}const ur=Object.freeze(Object.defineProperty({__proto__:null,fromBlackIsZero:lt,fromCIELab:ut,fromCMYK:ct,fromPalette:ht,fromWhiteIsZero:at,fromYCbCr:ft},Symbol.toStringTag,{value:"Module"})),gt=new Map;function U(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>gt.set(t,e))}async function Me(r){const e=gt.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}U([void 0,1],()=>k(()=>import("./raw-DUslI1gr-CHWxYEjV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));U(5,()=>k(()=>import("./lzw-BZniWIYG-DcfKN2jV.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));U(6,()=>{throw new Error("old style JPEG compression is not supported.")});U(7,()=>k(()=>import("./jpeg-CF9OGQg_-CuJhT80K.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));U([8,32946],()=>k(()=>import("./deflate-BA1jZeSX-DgczRPj8.js"),__vite__mapDeps([12,13,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));U(32773,()=>k(()=>import("./packbits-DWY5O-FG-CluKezWp.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));U(34887,()=>k(()=>import("./lerc-7LlQoT6u-Dbev0hlf.js"),__vite__mapDeps([15,13,2,3,4,5,6,7,1,8,9]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));U(50001,()=>k(()=>import("./webimage-ibSPOLHJ-CZqcyNLK.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.default));function de(r,e,t,i=1){return new(Object.getPrototypeOf(r)).constructor(e*t*i)}function gr(r,e,t,i,s){const n=e/i,o=t/s;return r.map(a=>{const h=de(a,i,s);for(let l=0;l<s;++l){const c=Math.min(Math.round(o*l),t-1);for(let f=0;f<i;++f){const g=Math.min(Math.round(n*f),e-1),d=a[c*e+g];h[l*i+f]=d}}return h})}function K(r,e,t){return(1-t)*r+t*e}function dr(r,e,t,i,s){const n=e/i,o=t/s;return r.map(a=>{const h=de(a,i,s);for(let l=0;l<s;++l){const c=o*l,f=Math.floor(c),g=Math.min(Math.ceil(c),t-1);for(let d=0;d<i;++d){const u=n*d,p=u%1,y=Math.floor(u),w=Math.min(Math.ceil(u),e-1),m=a[f*e+y],I=a[f*e+w],b=a[g*e+y],T=a[g*e+w],P=K(K(m,I,p),K(b,T,p),c%1);h[l*i+d]=P}}return h})}function pr(r,e,t,i,s,n="nearest"){switch(n.toLowerCase()){case"nearest":return gr(r,e,t,i,s);case"bilinear":case"linear":return dr(r,e,t,i,s);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function yr(r,e,t,i,s,n){const o=e/i,a=t/s,h=de(r,i,s,n);for(let l=0;l<s;++l){const c=Math.min(Math.round(a*l),t-1);for(let f=0;f<i;++f){const g=Math.min(Math.round(o*f),e-1);for(let d=0;d<n;++d){const u=r[c*e*n+g*n+d];h[l*i*n+f*n+d]=u}}}return h}function wr(r,e,t,i,s,n){const o=e/i,a=t/s,h=de(r,i,s,n);for(let l=0;l<s;++l){const c=a*l,f=Math.floor(c),g=Math.min(Math.ceil(c),t-1);for(let d=0;d<i;++d){const u=o*d,p=u%1,y=Math.floor(u),w=Math.min(Math.ceil(u),e-1);for(let m=0;m<n;++m){const I=r[f*e*n+y*n+m],b=r[f*e*n+w*n+m],T=r[g*e*n+y*n+m],P=r[g*e*n+w*n+m],H=K(K(I,b,p),K(T,P,p),c%1);h[l*i*n+d*n+m]=H}}}return h}function mr(r,e,t,i,s,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return yr(r,e,t,i,s,n);case"bilinear":case"linear":return wr(r,e,t,i,s,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Sr(r,e,t){let i=0;for(let s=e;s<t;++s)i+=r[s];return i}function Te(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function br(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function Ir(r,e,t,i,s,n,o){const a=new DataView(r),h=t===2?o*n:o*n*i,l=t===2?1:i,c=Te(e,s,h),f=parseInt("1".repeat(s),2);if(e===1){let g;t===1?g=i*s:g=s;let d=n*g;(d&7)!==0&&(d=d+7&-8);for(let u=0;u<o;++u){const p=u*d;for(let y=0;y<n;++y){const w=p+y*l*s;for(let m=0;m<l;++m){const I=w+m*s,b=(u*n+y)*l+m,T=Math.floor(I/8),P=I%8;if(P+s<=8)c[b]=a.getUint8(T)>>8-s-P&f;else if(P+s<=16)c[b]=a.getUint16(T)>>16-s-P&f;else if(P+s<=24){const H=a.getUint16(T)<<8|a.getUint8(T+2);c[b]=H>>24-s-P&f}else c[b]=a.getUint32(T)>>32-s-P&f}}}}return c.buffer}class Re{constructor(e,t,i,s,n,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=s,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(s,n){return it(this,s,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),s=this.getBitsPerSample(e);return Te(i,s,t)}async getTileOrStrip(e,t,i,s,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let h;const{tiles:l}=this;this.planarConfiguration===1?h=t*o+e:this.planarConfiguration===2&&(h=i*o*a+t*o+e);let c,f;this.isTiled?(c=this.fileDirectory.TileOffsets[h],f=this.fileDirectory.TileByteCounts[h]):(c=this.fileDirectory.StripOffsets[h],f=this.fileDirectory.StripByteCounts[h]);const g=(await this.source.fetch([{offset:c,length:f}],n))[0];let d;return l===null||!l[h]?(d=(async()=>{let u=await s.decode(this.fileDirectory,g);const p=this.getSampleFormat(),y=this.getBitsPerSample();return br(p,y)&&(u=Ir(u,p,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(t))),u})(),l!==null&&(l[h]=d)):d=l[h],{x:e,y:t,sample:i,data:await d}}async _readRaster(e,t,i,s,n,o,a,h,l){const c=this.getTileWidth(),f=this.getTileHeight(),g=this.getWidth(),d=this.getHeight(),u=Math.max(Math.floor(e[0]/c),0),p=Math.min(Math.ceil(e[2]/c),Math.ceil(g/c)),y=Math.max(Math.floor(e[1]/f),0),w=Math.min(Math.ceil(e[3]/f),Math.ceil(d/f)),m=e[2]-e[0];let I=this.getBytesPerPixel();const b=[],T=[];for(let E=0;E<t.length;++E)this.planarConfiguration===1?b.push(Sr(this.fileDirectory.BitsPerSample,0,t[E])/8):b.push(0),T.push(this.getReaderForSample(t[E]));const P=[],{littleEndian:H}=this;for(let E=y;E<w;++E)for(let ee=u;ee<p;++ee){let Se;this.planarConfiguration===1&&(Se=this.getTileOrStrip(ee,E,0,n,l));for(let te=0;te<t.length;++te){const re=te,Fe=t[te];this.planarConfiguration===2&&(I=this.getSampleByteSize(Fe),Se=this.getTileOrStrip(ee,E,Fe,n,l));const St=Se.then(j=>{const bt=j.data,It=new DataView(bt),be=this.getBlockHeight(j.y),q=j.y*f,ie=j.x*c,Tt=q+be,At=(j.x+1)*c,xt=T[re],Et=Math.min(be,be-(Tt-e[3]),d-q),Dt=Math.min(c,c-(At-e[2]),g-ie);for(let W=Math.max(0,e[1]-q);W<Et;++W)for(let $=Math.max(0,e[0]-ie);$<Dt;++$){const Pt=(W*c+$)*I,Ue=xt.call(It,Pt+b[re],H);let se;s?(se=(W+q-e[1])*m*t.length+($+ie-e[0])*t.length+re,i[se]=Ue):(se=(W+q-e[1])*m+$+ie-e[0],i[re][se]=Ue)}});P.push(St)}}if(await Promise.all(P),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let E;return s?E=mr(i,e[2]-e[0],e[3]-e[1],o,a,t.length,h):E=pr(i,e[2]-e[0],e[3]-e[1],o,a,h),E.width=o,E.height=a,E}return i.width=o||e[2]-e[0],i.height=a||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:s=null,width:n,height:o,resampleMethod:a,fillValue:h,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const f=c[2]-c[0],g=c[3]-c[1],d=f*g,u=this.getSamplesPerPixel();if(!t||!t.length)for(let w=0;w<u;++w)t.push(w);else for(let w=0;w<t.length;++w)if(t[w]>=u)return Promise.reject(new RangeError(`Invalid sample index '${t[w]}'.`));let p;if(i){const w=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,m=Math.max.apply(null,this.fileDirectory.BitsPerSample);p=Te(w,m,d*t.length),h&&p.fill(h)}else{p=[];for(let w=0;w<t.length;++w){const m=this.getArrayForSample(t[w],d);Array.isArray(h)&&w<h.length?m.fill(h[w]):h&&!Array.isArray(h)&&m.fill(h),p.push(m)}}const y=s||await Me(this.fileDirectory);return await this._readRaster(c,t,p,i,y,n,o,a,l)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:s,height:n,resampleMethod:o,enableAlpha:a=!1,signal:h}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===_.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==nt.Unspecified&&a){w=[];for(let m=0;m<this.fileDirectory.BitsPerSample.length;m+=1)w.push(m)}return this.readRasters({window:e,interleave:t,samples:w,pool:i,width:s,height:n,resampleMethod:o,signal:h})}let f;switch(c){case _.WhiteIsZero:case _.BlackIsZero:case _.Palette:f=[0];break;case _.CMYK:f=[0,1,2,3];break;case _.YCbCr:case _.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const g={window:l,interleave:!0,samples:f,pool:i,width:s,height:n,resampleMethod:o,signal:h},{fileDirectory:d}=this,u=await this.readRasters(g),p=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case _.WhiteIsZero:y=at(u,p);break;case _.BlackIsZero:y=lt(u,p);break;case _.Palette:y=ht(u,d.ColorMap);break;case _.CMYK:y=ct(u);break;case _.YCbCr:y=ft(u);break;case _.CIELab:y=ut(u);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const w=new Uint8Array(y.length/3),m=new Uint8Array(y.length/3),I=new Uint8Array(y.length/3);for(let b=0,T=0;b<y.length;b+=3,++T)w[T]=y[b],m[T]=y[b+1],I[T]=y[b+2];y=[w,m,I]}return y.width=u.width,y.height=u.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let s=nr(i,"Item");e===null?s=s.filter(n=>Ie(n,"sample")===void 0):s=s.filter(n=>Number(Ie(n,"sample"))===e);for(let n=0;n<s.length;++n){const o=s[n];t[Ie(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[s,n,o]=e.getResolution();return[s*e.getWidth()/this.getWidth(),n*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[s,n,o,a,h,l,c,f]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,t],[i,0],[i,t]].map(([p,y])=>[a+s*p+n*y,f+h*p+l*y]),d=g.map(p=>p[0]),u=g.map(p=>p[1]);return[Math.min(...d),Math.min(...u),Math.max(...d),Math.max(...u)]}else{const s=this.getOrigin(),n=this.getResolution(),o=s[0],a=s[1],h=o+n[0]*i,l=a+n[1]*t;return[Math.min(o,h),Math.min(a,l),Math.max(o,h),Math.max(a,l)]}}}class Tr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),s=this.getUint32(e+4,t);let n;if(t){if(n=i+2**32*s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*i+s,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(e,t){let i=0;const s=(this._dataView.getUint8(e+(t?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));s&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),i+=a*256**o}return s&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return it(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Ar{constructor(e,t,i,s){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let s;if(this._littleEndian){if(s=t+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*t+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let s=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(this._littleEndian?n:7-n));i&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),t+=o*256**n}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const xr=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Er{constructor(e=xr,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{k(()=>import("./decoder-CLokFc0V-tqM1uIvc.js"),[],import.meta.url).then(s=>{i(s.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<e;s++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Me(e).then(i=>i.decode(e,t)):new Promise(i=>{const s=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const n=this.messageId++,o=a=>{a.data.id===n&&(s.idle=!0,i(a.data.decoded),s.worker.removeEventListener("message",o))};s.worker.addEventListener("message",o),s.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Ve=`\r
\r
`;function dt(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,i]of r)e[t.toLowerCase()]=i;return e}function Dr(r){const e=r.split(`\r
`).map(t=>{const i=t.split(":").map(s=>s.trim());return i[0]=i[0].toLowerCase(),i});return dt(e)}function Pr(r){const[e,...t]=r.split(";").map(s=>s.trim()),i=t.map(s=>s.split("="));return{type:e,params:dt(i)}}function Ae(r){let e,t,i;return r&&([,e,t,i]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function _r(r,e){let t=null;const i=new TextDecoder("ascii"),s=[],n=`--${e}`,o=`${n}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(r,a,n.length))===n&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=i.decode(new Uint8Array(r,t,Math.min(n.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(n))throw new Error("Part does not start with boundary");const h=a.substr(n.length+2);if(h.length===0)break;const l=h.indexOf(Ve),c=Dr(h.substr(0,l)),{start:f,end:g,total:d}=Ae(c["content-range"]),u=t+n.length+l+Ve.length,p=parseInt(g,10)+1-parseInt(f,10);s.push({headers:c,data:r.slice(u,u+p),offset:f,length:p,fileSize:d}),t=u+p+4}return s}class Q{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Or extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const s=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:s}):this._set(e,{value:t,expiry:s}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[s,n]=i;this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[s,n]=i;this.cache.has(s)||this._deleteIfExpired(s,n)===!1&&(yield[s,n.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,s]of this.entriesAscending())e.call(t,s,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}function pt(r,e){for(const t in e)e.hasOwnProperty(t)&&(r[t]=e[t])}function yt(r,e){return r.length<e.length?!1:r.substr(r.length-e.length)===e}function Cr(r,e){const{length:t}=r;for(let i=0;i<t;i++)e(r[i],i)}function Ge(r){const e={};for(const t in r)if(r.hasOwnProperty(t)){const i=r[t];e[i]=t}return e}function O(r,e){const t=[];for(let i=0;i<r;i++)t.push(e(i));return t}async function Mr(r){return new Promise(e=>setTimeout(e,r))}function Rr(r,e){const t=Array.isArray(r)?r:Array.from(r),i=Array.isArray(e)?e:Array.from(e);return t.map((s,n)=>[s,i[n]])}class B extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,B),this.name="AbortError"}}class Gr extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Fr=Gr;class Ur{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class He{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class kr extends Q{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new Or({maxSize:i,onEviction:(s,n)=>{this.evictedBlocks.set(s,n)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=[],s=[],n=[];this.evictedBlocks.clear();for(const{offset:g,length:d}of e){let u=g+d;const{fileSize:p}=this;p!==null&&(u=Math.min(u,p));const y=Math.floor(g/this.blockSize)*this.blockSize;for(let w=y;w<u;w+=this.blockSize){const m=Math.floor(w/this.blockSize);!this.blockCache.has(m)&&!this.blockRequests.has(m)&&(this.blockIdsToFetch.add(m),s.push(m)),this.blockRequests.has(m)&&i.push(this.blockRequests.get(m)),n.push(m)}}await Mr(),this.fetchBlocks(t);const o=[];for(const g of s)this.blockRequests.has(g)&&o.push(this.blockRequests.get(g));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],h=n.filter(g=>this.abortedBlockIds.has(g)||!this.blockCache.has(g));if(h.forEach(g=>this.blockIdsToFetch.add(g)),h.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const g of h){const d=this.blockRequests.get(g);if(!d)throw new Error(`Block ${g} is not in the block requests`);a.push(d)}await Promise.allSettled(a)}if(t&&t.aborted)throw new B("Request was aborted");const l=n.map(g=>this.blockCache.get(g)||this.evictedBlocks.get(g)),c=l.filter(g=>!g);if(c.length)throw new Fr(c,"Request failed");const f=new Map(Rr(n,l));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let s=0;s<t.length;++s){const n=t[s];for(const o of n.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[s],h=o*this.blockSize,l=h-a.offset,c=Math.min(l+this.blockSize,a.data.byteLength),f=a.data.slice(l,c),g=new Ur(h,f.byteLength,f,o);this.blockCache.set(o,g),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let i=[],s=null;const n=[];for(const o of t)s===null||s+1===o?(i.push(o),s=o):(n.push(new He(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],s=o);return n.push(new He(i[0]*this.blockSize,i.length*this.blockSize,i)),n}readSliceData(e,t){return e.map(i=>{let s=i.offset+i.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const n=Math.floor(i.offset/this.blockSize),o=Math.floor(s/this.blockSize),a=new ArrayBuffer(i.length),h=new Uint8Array(a);for(let l=n;l<=o;++l){const c=t.get(l),f=c.offset-i.offset,g=c.top-s;let d=0,u=0,p;f<0?d=-f:f>0&&(u=f),g<0?p=c.length-d:p=s-c.offset-d;const y=new Uint8Array(c.data,d,p);h.set(y,u)}return a})}}class pe{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class ye{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class Lr extends pe{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Br extends ye{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const i=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new Lr(i)}}class vr extends pe{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Nr extends ye{constructRequest(e,t){return new Promise((i,s)=>{const n=new XMLHttpRequest;n.open("GET",this.url),n.responseType="arraybuffer";for(const[o,a]of Object.entries(e))n.setRequestHeader(o,a);n.onload=()=>{const o=n.response;i(new vr(n,o))},n.onerror=s,n.onabort=()=>s(new B("Request aborted")),n.send(),t&&(t.aborted&&n.abort(),t.addEventListener("abort",()=>n.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Kr extends pe{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class zr extends ye{constructor(e){super(e),this.parsedUrl=X.parse(this.url),this.httpApi=(this.parsedUrl.protocol,X)}constructRequest(e,t){return new Promise((i,s)=>{const n=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(h=>{const l=[];o.on("data",c=>{l.push(c)}),o.on("end",()=>{const c=Buffer.concat(l).buffer;h(c)}),o.on("error",s)});i(new Kr(o,a))});n.on("error",s),t&&(t.aborted&&n.destroy(new B("Request aborted")),t.addEventListener("abort",()=>n.destroy(new B("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class we extends Q{constructor(e,t,i,s){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=s,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:s,length:n})=>`${s}-${s+n}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:s,params:n}=Pr(i.getHeader("content-type"));if(s==="multipart/byteranges"){const f=_r(await i.getData(),n.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await i.getData(),{start:a,end:h,total:l}=Ae(i.getHeader("content-range"));this._fileSize=l||null;const c=[{data:o,offset:a,length:h-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(g=>this.fetchSlice(g,t)));return c.concat(f)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await i.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:s}=e,n=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+s}`},signal:t});if(n.ok)if(n.status===206){const o=await n.getData(),{total:a}=Ae(n.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await n.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function me(r,{blockSize:e,cacheSize:t}){return e===null?r:new kr(r,{blockSize:e,cacheSize:t})}function Vr(r,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:s=!1,...n}={}){const o=new Br(r,t),a=new we(o,e,i,s);return me(a,n)}function Hr(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...s}={}){const n=new Nr(r),o=new we(n,e,t,i);return me(o,s)}function jr(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...s}={}){const n=new zr(r),o=new we(n,e,t,i);return me(o,s)}function qr(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...s}={}){const n=new we(r,e,t,i);return me(n,s)}function xe(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?Vr(r,t):typeof XMLHttpRequest<"u"?Hr(r,t):jr(r,t)}class Wr extends Q{constructor(e){super(),this.arrayBuffer=e}fetchSlice(e,t){if(t&&t.aborted)throw new B("Request aborted");return this.arrayBuffer.slice(e.offset,e.offset+e.length)}}function $r(r){return new Wr(r)}class Yr extends Q{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,s)=>{const n=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=s,o.onabort=s,o.readAsArrayBuffer(n),t&&t.addEventListener("abort",()=>o.abort())})}}function Xr(r){return new Yr(r)}function Zr(r){return new Promise((e,t)=>{X.close(r,i=>{i?t(i):e()})})}function Jr(r,e,t=void 0){return new Promise((i,s)=>{X.open(r,e,t,(n,o)=>{n?s(n):i(o)})})}function Qr(...r){return new Promise((e,t)=>{X.read(...r,(i,s,n)=>{i?t(i):e({bytesRead:s,buffer:n})})})}class ei extends Q{constructor(e){super(),this.path=e,this.openRequest=Jr(e,"r")}async fetchSlice(e){const t=await this.openRequest,{buffer:i}=await Qr(t,Buffer.alloc(e.length),0,e.length,e.offset);return i.buffer}async close(){const e=await this.openRequest;await Zr(e)}}function ti(r){return new ei(r)}const ri=Ge(L),ii=Ge(N),F={};pt(F,ri);pt(F,ii);const si=Ge(Y),ue=1e3,x={nextZero:(r,e)=>{let t=e;for(;r[t]!==0;)t++;return t},readUshort:(r,e)=>r[e]<<8|r[e+1],readShort:(r,e)=>{const t=x.ui8;return t[0]=r[e+1],t[1]=r[e+0],x.i16[0]},readInt:(r,e)=>{const t=x.ui8;return t[0]=r[e+3],t[1]=r[e+2],t[2]=r[e+1],t[3]=r[e+0],x.i32[0]},readUint:(r,e)=>{const t=x.ui8;return t[0]=r[e+3],t[1]=r[e+2],t[2]=r[e+1],t[3]=r[e+0],x.ui32[0]},readASCII:(r,e,t)=>t.map(i=>String.fromCharCode(r[e+i])).join(""),readFloat:(r,e)=>{const t=x.ui8;return O(4,i=>{t[i]=r[e+3-i]}),x.fl32[0]},readDouble:(r,e)=>{const t=x.ui8;return O(8,i=>{t[i]=r[e+7-i]}),x.fl64[0]},writeUshort:(r,e,t)=>{r[e]=t>>8&255,r[e+1]=t&255},writeUint:(r,e,t)=>{r[e]=t>>24&255,r[e+1]=t>>16&255,r[e+2]=t>>8&255,r[e+3]=t>>0&255},writeASCII:(r,e,t)=>{O(t.length,i=>{r[e+i]=t.charCodeAt(i)})},ui8:new Uint8Array(8)};x.fl64=new Float64Array(x.ui8.buffer);x.writeDouble=(r,e,t)=>{x.fl64[0]=t,O(8,i=>{r[e+i]=x.ui8[7-i]})};const ni=(r,e,t,i)=>{let s=t;const n=Object.keys(i).filter(a=>a!=null&&a!=="undefined");r.writeUshort(e,s,n.length),s+=2;let o=s+12*n.length+4;for(const a of n){let h=null;typeof a=="number"?h=a:typeof a=="string"&&(h=parseInt(a,10));const l=ge[h],c=si[l];if(l==null||l===void 0||typeof l>"u")throw new Error(`unknown type of tag: ${h}`);let f=i[a];if(f===void 0)throw new Error(`failed to get value for key ${a}`);l==="ASCII"&&typeof f=="string"&&yt(f,"\0")===!1&&(f+="\0");const g=f.length;r.writeUshort(e,s,h),s+=2,r.writeUshort(e,s,c),s+=2,r.writeUint(e,s,g),s+=4;let d=[-1,1,1,2,4,8,0,0,0,0,0,0,8][c]*g,u=s;d>4&&(r.writeUint(e,s,o),u=o),l==="ASCII"?r.writeASCII(e,u,f):l==="SHORT"?O(g,p=>{r.writeUshort(e,u+2*p,f[p])}):l==="LONG"?O(g,p=>{r.writeUint(e,u+4*p,f[p])}):l==="RATIONAL"?O(g,p=>{r.writeUint(e,u+8*p,Math.round(f[p]*1e4)),r.writeUint(e,u+8*p+4,1e4)}):l==="DOUBLE"&&O(g,p=>{r.writeDouble(e,u+8*p,f[p])}),d>4&&(d+=d&1,o+=d),s+=4}return[s,o]},oi=r=>{const e=new Uint8Array(ue);let t=4;const i=x;e[0]=77,e[1]=77,e[3]=42;let s=8;if(i.writeUint(e,t,s),t+=4,r.forEach((o,a)=>{const h=ni(i,e,s,o);s=h[1],a<r.length-1&&i.writeUint(e,h[0],s)}),e.slice)return e.slice(0,s).buffer;const n=new Uint8Array(s);for(let o=0;o<s;o++)n[o]=e[o];return n.buffer},ai=(r,e,t,i)=>{if(t==null)throw new Error(`you passed into encodeImage a width of type ${t}`);if(e==null)throw new Error(`you passed into encodeImage a width of type ${e}`);const s={256:[e],257:[t],273:[ue],278:[t],305:"geotiff.js"};if(i)for(const l in i)i.hasOwnProperty(l)&&(s[l]=i[l]);const n=new Uint8Array(oi([s])),o=new Uint8Array(r),a=s[277],h=new Uint8Array(ue+e*t*a);return O(n.length,l=>{h[l]=n[l]}),Cr(o,(l,c)=>{h[ue+c]=l}),h.buffer},li=r=>{const e={};for(const t in r)t!=="StripOffsets"&&(F[t]||console.error(t,"not in name2code:",Object.keys(F)),e[F[t]]=r[t]);return e},hi=r=>Array.isArray(r)?r:[r],ci=[["Compression",1],["PlanarConfiguration",1],["ExtraSamples",0]];function fi(r,e){const t=typeof r[0]=="number";let i,s,n,o;t?(i=e.height||e.ImageLength,n=e.width||e.ImageWidth,s=r.length/(i*n),o=r):(s=r.length,i=r[0].length,n=r[0][0].length,o=[],O(i,l=>{O(n,c=>{O(s,f=>{o.push(r[f][l][c])})})})),e.ImageLength=i,delete e.height,e.ImageWidth=n,delete e.width,e.BitsPerSample||(e.BitsPerSample=O(s,()=>8)),ci.forEach(l=>{const c=l[0];if(!e[c]){const f=l[1];e[c]=f}}),e.PhotometricInterpretation||(e.PhotometricInterpretation=e.BitsPerSample.length===3?2:1),e.SamplesPerPixel||(e.SamplesPerPixel=[s]),e.StripByteCounts||(e.StripByteCounts=[s*i*n]),e.ModelPixelScale||(e.ModelPixelScale=[360/n,180/i,0]),e.SampleFormat||(e.SampleFormat=O(s,()=>1)),!e.hasOwnProperty("GeographicTypeGeoKey")&&!e.hasOwnProperty("ProjectedCSTypeGeoKey")&&(e.GeographicTypeGeoKey=4326,e.ModelTiepoint=[0,0,0,-180,90,0],e.GeogCitationGeoKey="WGS 84",e.GTModelTypeGeoKey=2);const a=Object.keys(e).filter(l=>yt(l,"GeoKey")).sort((l,c)=>F[l]-F[c]);if(!e.GeoAsciiParams){let l="";a.forEach(c=>{const f=Number(F[c]);ge[f]==="ASCII"&&(l+=`${e[c].toString()}\0`)}),l.length>0&&(e.GeoAsciiParams=l)}if(!e.GeoKeyDirectory){const l=[1,1,0,a.length];a.forEach(c=>{const f=Number(F[c]);l.push(f);let g,d,u;ge[f]==="SHORT"?(g=1,d=0,u=e[c]):c==="GeogCitationGeoKey"?(g=e.GeoAsciiParams.length,d=Number(F.GeoAsciiParams),u=0):console.log(`[geotiff.js] couldn't get TIFFTagLocation for ${c}`),l.push(d),l.push(g),l.push(u)}),e.GeoKeyDirectory=l}for(const l of a)e.hasOwnProperty(l)&&delete e[l];["Compression","ExtraSamples","GeographicTypeGeoKey","GTModelTypeGeoKey","GTRasterTypeGeoKey","ImageLength","ImageWidth","Orientation","PhotometricInterpretation","ProjectedCSTypeGeoKey","PlanarConfiguration","ResolutionUnit","SamplesPerPixel","XPosition","YPosition","RowsPerStrip"].forEach(l=>{e[l]&&(e[l]=hi(e[l]))});const h=li(e);return ai(o,n,i,h)}class ui{log(){}debug(){}info(){}warn(){}error(){}time(){}timeEnd(){}}function gi(r=new ui){}function di(r,e){let t=r.length-e,i=0;do{for(let s=e;s>0;s--)r[i+e]+=r[i],i++;t-=e}while(t>0)}function pi(r,e,t){let i=0,s=r.length;const n=s/t;for(;s>e;){for(let a=e;a>0;--a)r[i+e]+=r[i],++i;s-=e}const o=r.slice();for(let a=0;a<n;++a)for(let h=0;h<t;++h)r[t*a+h]=o[(t-h-1)*n+a]}function yi(r,e,t,i,s,n){if(e===1)return r;for(let h=0;h<s.length;++h){if(s[h]%8!==0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(s[h]!==s[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const o=s[0]/8,a=n===2?1:s.length;for(let h=0;h<i&&!(h*a*t*o>=r.byteLength);++h){let l;if(e===2){switch(s[0]){case 8:l=new Uint8Array(r,h*a*t*o,a*t*o);break;case 16:l=new Uint16Array(r,h*a*t*o,a*t*o/2);break;case 32:l=new Uint32Array(r,h*a*t*o,a*t*o/4);break;default:throw new Error(`Predictor 2 not allowed with ${s[0]} bits per sample.`)}di(l,a)}else e===3&&(l=new Uint8Array(r,h*a*t*o,a*t*o),pi(l,a,o))}return r}class wi{async decode(e,t){const i=await this.decodeBlock(t),s=e.Predictor||1;if(s!==1){const n=!e.StripOffsets,o=n?e.TileWidth:e.ImageWidth,a=n?e.TileLength:e.RowsPerStrip||e.ImageLength;return yi(i,s,o,a,e.BitsPerSample,e.PlanarConfiguration)}return i}}function Ee(r){switch(r){case S.BYTE:case S.ASCII:case S.SBYTE:case S.UNDEFINED:return 1;case S.SHORT:case S.SSHORT:return 2;case S.LONG:case S.SLONG:case S.FLOAT:case S.IFD:return 4;case S.RATIONAL:case S.SRATIONAL:case S.DOUBLE:case S.LONG8:case S.SLONG8:case S.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function mi(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const s=N[e[i]],n=e[i+1]?L[e[i+1]]:null,o=e[i+2],a=e[i+3];let h=null;if(!n)h=a;else{if(h=r[n],typeof h>"u"||h===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof h=="string"?h=h.substring(a,a+o-1):h.subarray&&(h=h.subarray(a,a+o),o===1&&(h=h[0]))}t[s]=h}return t}function v(r,e,t,i){let s=null,n=null;const o=Ee(e);switch(e){case S.BYTE:case S.ASCII:case S.UNDEFINED:s=new Uint8Array(t),n=r.readUint8;break;case S.SBYTE:s=new Int8Array(t),n=r.readInt8;break;case S.SHORT:s=new Uint16Array(t),n=r.readUint16;break;case S.SSHORT:s=new Int16Array(t),n=r.readInt16;break;case S.LONG:case S.IFD:s=new Uint32Array(t),n=r.readUint32;break;case S.SLONG:s=new Int32Array(t),n=r.readInt32;break;case S.LONG8:case S.IFD8:s=new Array(t),n=r.readUint64;break;case S.SLONG8:s=new Array(t),n=r.readInt64;break;case S.RATIONAL:s=new Uint32Array(t*2),n=r.readUint32;break;case S.SRATIONAL:s=new Int32Array(t*2),n=r.readInt32;break;case S.FLOAT:s=new Float32Array(t),n=r.readFloat32;break;case S.DOUBLE:s=new Float64Array(t),n=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===S.RATIONAL||e===S.SRATIONAL)for(let a=0;a<t;a+=2)s[a]=n.call(r,i+a*o),s[a+1]=n.call(r,i+(a*o+4));else for(let a=0;a<t;++a)s[a]=n.call(r,i+a*o);return e===S.ASCII?new TextDecoder("utf-8").decode(s):s}class Si{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class fe extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class wt{async readRasters(e={}){const{window:t,width:i,height:s}=e;let{resX:n,resY:o,bbox:a}=e;const h=await this.getImage();let l=h;const c=await this.getImageCount(),f=h.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(i||s){if(t){const[u,p]=h.getOrigin(),[y,w]=h.getResolution();a=[u+t[0]*y,p+t[1]*w,u+t[2]*y,p+t[3]*w]}const d=a||f;if(i){if(n)throw new Error("Both width and resX passed");n=(d[2]-d[0])/i}if(s){if(o)throw new Error("Both width and resY passed");o=(d[3]-d[1])/s}}if(n||o){const d=[];for(let u=0;u<c;++u){const p=await this.getImage(u),{SubfileType:y,NewSubfileType:w}=p.fileDirectory;(u===0||y===2||w&1)&&d.push(p)}d.sort((u,p)=>u.getWidth()-p.getWidth());for(let u=0;u<d.length;++u){const p=d[u],y=(f[2]-f[0])/p.getWidth(),w=(f[3]-f[1])/p.getHeight();if(l=p,n&&n>y||o&&o>w)break}}let g=t;if(a){const[d,u]=h.getOrigin(),[p,y]=l.getResolution(h);g=[Math.round((a[0]-d)/p),Math.round((a[1]-u)/y),Math.round((a[2]-d)/p),Math.round((a[3]-u)/y)],g=[Math.min(g[0],g[2]),Math.min(g[1],g[3]),Math.max(g[0],g[2]),Math.max(g[1],g[3])]}return l.readRasters({...e,window:g})}}class M extends wt{constructor(e,t,i,s,n={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=s,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new Ar((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let s=await this.getSlice(e);const n=this.bigTiff?s.readUint64(e):s.readUint16(e),o=n*t+(this.bigTiff?16:6);s.covers(e,o)||(s=await this.getSlice(e,o));const a={};let h=e+(this.bigTiff?8:2);for(let f=0;f<n;h+=t,++f){const g=s.readUint16(h),d=s.readUint16(h+2),u=this.bigTiff?s.readUint64(h+4):s.readUint32(h+4);let p,y;const w=Ee(d),m=h+(this.bigTiff?12:8);if(w*u<=(this.bigTiff?8:4))p=v(s,d,u,m);else{const I=s.readOffset(m),b=Ee(d)*u;if(s.covers(I,b))p=v(s,d,u,I);else{const T=await this.getSlice(I,b);p=v(T,d,u,I)}}u===1&&st.indexOf(g)===-1&&!(d===S.RATIONAL||d===S.SRATIONAL)?y=p[0]:y=p,a[L[g]]=y}const l=mi(a),c=s.readOffset(e+i+t*n);return new Si(a,l,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof fe?new fe(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new fe(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Re(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof fe)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let s=await this.getSlice(e,i);if(t===v(s,S.ASCII,t.length,e)){const n=v(s,S.ASCII,i,e).split(`
`)[0],o=Number(n.split("=")[1].split(" ")[0])+n.length;o>i&&(s=await this.getSlice(e,o));const a=v(s,S.ASCII,o,e);this.ghostValues={},a.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,l])=>{this.ghostValues[h]=l})}return this.ghostValues}static async fromSource(e,t,i){const s=(await e.fetch([{offset:0,length:1024}],i))[0],n=new Tr(s),o=n.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const h=n.getUint16(2,a);let l;if(h===42)l=!1;else if(h===43){if(l=!0,n.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=l?n.getUint64(8,a):n.getUint32(4,a);return new M(e,a,l,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class mt extends wt{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let s=0;s<this.imageFiles.length;s++){const n=this.imageFiles[s];for(let o=0;o<this.imageCounts[s];o++){if(e===t){const a=await n.requestIFD(i);return new Re(a.fileDirectory,a.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function bi(r,e={},t){return M.fromSource(xe(r,e),t)}async function Ii(r,e={},t){return M.fromSource(qr(r,e),t)}async function Ti(r,e){return M.fromSource($r(r),e)}async function Ai(r,e){return M.fromSource(ti(r),e)}async function xi(r,e){return M.fromSource(Xr(r),e)}async function Ei(r,e=[],t={},i){const s=await M.fromSource(xe(r,t),i),n=await Promise.all(e.map(o=>M.fromSource(xe(o,t))));return new mt(s,n)}function Di(r,e){return fi(r,e)}const Fi=Object.freeze(Object.defineProperty({__proto__:null,BaseClient:ye,BaseDecoder:wi,BaseResponse:pe,GeoTIFF:M,GeoTIFFImage:Re,MultiGeoTIFF:mt,Pool:Er,addDecoder:U,default:M,fromArrayBuffer:Ti,fromBlob:xi,fromCustomClient:Ii,fromFile:Ai,fromUrl:bi,fromUrls:Ei,getDecoder:Me,globals:lr,rgb:ur,setLogger:gi,writeArrayBuffer:Di},Symbol.toStringTag,{value:"Module"}));export{wi as B,or as L,Er as P,ar as a,Ti as b,xi as c,ye as d,Ii as e,bi as f,Fi as g};
