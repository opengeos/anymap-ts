const x=new Uint8Array([102,103,98,3,102,103,98,0]),T=4,ot=2,V=4,A=4,q=4,E=new Int32Array(2),Ft=new Float32Array(E.buffer),xt=new Float64Array(E.buffer),Z=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ht;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(ht||(ht={}));class C{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new C(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return E[0]=this.readInt32(t),Ft[0]}readFloat64(t){return E[Z?0:1]=this.readInt32(t),E[Z?1:0]=this.readInt32(t+4),xt[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Ft[0]=e,this.writeInt32(t,E[0])}writeFloat64(t,e){xt[0]=e,this.writeInt32(t,E[Z?0:1]),this.writeInt32(t+4,E[Z?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+V+A)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<A;e++)t+=String.fromCharCode(this.readInt8(this.position_+V+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=V;const i=this.bytes_.subarray(t,t+r);return e===ht.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+V}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=A)throw new Error("FlatBuffers: file identifier must be length "+A);for(let e=0;e<A;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+V+e))return!1;return!0}createScalarList(t,e){const r=[];for(let i=0;i<e;++i){const n=t(i);n!==null&&r.push(n)}return r}createObjList(t,e){const r=[];for(let i=0;i<e;++i){const n=t(i);n!==null&&r.push(n.unpack())}return r}}class tt{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let e;t?e=t:e=1024,this.bb=C.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const r=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<r+t+e;){const i=this.bb.capacity();this.bb=tt.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(r)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,r){(this.force_defaults||e!==r)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,r){e!=r&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=e<<1,i=C.allocate(r);return i.setPosition(r-e),i.bytes().set(t.bytes(),r-e),i}addOffset(t){this.prep(V,0),this.writeInt32(this.offset()-t+V)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const r=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const i=2;this.addInt16(t-this.object_start);const n=(r+i)*ot;this.addInt16(n);let a=0;const l=this.space;t:for(e=0;e<this.vtables.length;e++){const u=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(u)){for(let o=ot;o<n;o+=ot)if(this.bb.readInt16(l+o)!=this.bb.readInt16(u+o))continue t;a=this.vtables[e];break}}return a?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,a-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,r){const i=r?q:0;if(e){const n=e;if(this.prep(this.minalign,V+A+i),n.length!=A)throw new TypeError("FlatBuffers: file identifier must be length "+A);for(let a=A-1;a>=0;a--)this.writeInt8(n.charCodeAt(a))}this.prep(this.minalign,V+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const r=this.bb.capacity()-t,i=r-this.bb.readInt32(r);if(!(e<this.bb.readInt16(i)&&this.bb.readInt16(i+e)!=0))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(V,t*e),this.prep(r,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(t==null)return 0;let e;return t instanceof Uint8Array?e=t:e=this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let r=0;r<t.length;++r){const i=t[r];if(i!==null)e.push(this.createObjectOffset(i));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}}var g,y=((g={})[g.Byte=0]="Byte",g[g.UByte=1]="UByte",g[g.Bool=2]="Bool",g[g.Short=3]="Short",g[g.UShort=4]="UShort",g[g.Int=5]="Int",g[g.UInt=6]="UInt",g[g.Long=7]="Long",g[g.ULong=8]="ULong",g[g.Float=9]="Float",g[g.Double=10]="Double",g[g.String=11]="String",g[g.Json=12]="Json",g[g.DateTime=13]="DateTime",g[g.Binary=14]="Binary",g);class v{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new v).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+q),(e||new v).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):y.Byte}title(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){let t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}unique(){let t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}primaryKey(){let t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}metadata(t){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,y.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){let e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,r,i,n,a,l,u,o,h,c,b){return v.startColumn(t),v.addName(t,e),v.addType(t,r),v.addTitle(t,i),v.addDescription(t,n),v.addWidth(t,a),v.addPrecision(t,l),v.addScale(t,u),v.addNullable(t,o),v.addUnique(t,h),v.addPrimaryKey(t,c),v.addMetadata(t,b),v.endColumn(t)}}var _,I=((_={})[_.Unknown=0]="Unknown",_[_.Point=1]="Point",_[_.LineString=2]="LineString",_[_.Polygon=3]="Polygon",_[_.MultiPoint=4]="MultiPoint",_[_.MultiLineString=5]="MultiLineString",_[_.MultiPolygon=6]="MultiPolygon",_[_.GeometryCollection=7]="GeometryCollection",_[_.CircularString=8]="CircularString",_[_.CompoundCurve=9]="CompoundCurve",_[_.CurvePolygon=10]="CurvePolygon",_[_.MultiCurve=11]="MultiCurve",_[_.MultiSurface=12]="MultiSurface",_[_.Curve=13]="Curve",_[_.Surface=14]="Surface",_[_.PolyhedralSurface=15]="PolyhedralSurface",_[_.TIN=16]="TIN",_[_.Triangle=17]="Triangle",_);class w{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new w).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+q),(e||new w).__init(t.readInt32(t.position())+t.position(),t)}ends(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}endsLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){let t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}xyLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}zLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){let t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}mLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){let t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}tLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){let t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}tmLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):I.Unknown}parts(t,e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new w).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}partsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,I.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,r,i,n,a,l,u,o){return w.startGeometry(t),w.addEnds(t,e),w.addXy(t,r),w.addZ(t,i),w.addM(t,n),w.addT(t,a),w.addTm(t,l),w.addType(t,u),w.addParts(t,o),w.endGeometry(t)}}class F{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new F).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+q),(e||new F).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){let e=this.bb.__offset(this.bb_pos,4);return e?(t||new w).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){let r=this.bb.__offset(this.bb_pos,8);return r?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,r,i){return F.startFeature(t),F.addGeometry(t,e),F.addProperties(t,r),F.addColumns(t,i),F.endFeature(t)}}function Vt(s,t){let e,r,i,{xy:n,z:a,m:l,ends:u,parts:o,type:h}=t;if(o){let b=o.map(d=>Vt(s,d)),f=w.createPartsVector(s,b);return w.startGeometry(s),w.addParts(s,f),w.addType(s,h),w.endGeometry(s)}let c=w.createXyVector(s,n);return a&&(e=w.createZVector(s,a)),l&&(r=w.createMVector(s,l)),u&&(i=w.createEndsVector(s,u)),w.startGeometry(s),i&&w.addEnds(s,i),w.addXy(s,c),e&&w.addZ(s,e),r&&w.addM(s,r),w.addType(s,h),w.endGeometry(s)}function bt(s,t,e){if(s.length!==0)if(Array.isArray(s[0]))for(let r of s)bt(r,t,e);else s.length===2?t.push(...s):(t.push(s[0],s[1]),e.push(s[2]))}function lt(s,t){let e=[];for(let r=0;r<s.length;r+=2){let i=[s[r],s[r+1]];t&&i.push(t[r>>1]),e.push(i)}return e}function J(s){return s?I[s]:I.Unknown}let Ut=new TextEncoder,Pt=new TextDecoder;function Rt(s,t,e){let r=e.columns,i=new tt,n=0,a=1024,l=new Uint8Array(1024),u=new DataView(l.buffer),o=f=>{if(n+f<a)return;let d=new Uint8Array(a=Math.max(a+f,2*a));d.set(l),u=new DataView((l=d).buffer)};if(r)for(let f=0;f<r.length;f++){let d=r[f],p=t[d.name];if(p!==null)switch(o(2),u.setUint16(n,f,!0),n+=2,d.type){case y.Bool:o(1),u.setUint8(n,p),n+=1;break;case y.Short:o(2),u.setInt16(n,p,!0),n+=2;break;case y.UShort:o(2),u.setUint16(n,p,!0),n+=2;break;case y.Int:o(4),u.setInt32(n,p,!0),n+=4;break;case y.UInt:o(4),u.setUint32(n,p,!0),n+=4;break;case y.Long:o(8),u.setBigInt64(n,BigInt(p),!0),n+=8;break;case y.Float:o(4),u.setFloat32(n,p,!0),n+=4;break;case y.Double:o(8),u.setFloat64(n,p,!0),n+=8;break;case y.DateTime:case y.String:{let m=Ut.encode(p);o(4),u.setUint32(n,m.length,!0),n+=4,o(m.length),l.set(m,n),n+=m.length;break}case y.Json:{let m=Ut.encode(JSON.stringify(p));o(4),u.setUint32(n,m.length,!0),n+=4,o(m.length),l.set(m,n),n+=m.length;break}case y.Binary:o(4),u.setUint32(n,p.length,!0),n+=4,o(p.length),l.set(p,n),n+=p.length;break;default:throw Error(`Unknown type ${d.type}`)}}let h=0;n>0&&(h=F.createPropertiesVector(i,l.slice(0,n)));let c=Vt(i,s);F.startFeature(i),F.addGeometry(i,c),h&&F.addProperties(i,h);let b=F.endFeature(i);return i.finishSizePrefixed(b),i.asUint8Array()}function Mt(s,t){let e={};if(!t||t.length===0)return e;let r=s.propertiesArray();if(!r)return e;let i=new DataView(r.buffer,r.byteOffset),n=s.propertiesLength(),a=0;for(;a<n;){let l=i.getUint16(a,!0);a+=2;let u=t[l],o=u.name;switch(u.type){case y.Bool:e[o]=!!i.getUint8(a),a+=1;break;case y.Byte:e[o]=i.getInt8(a),a+=1;break;case y.UByte:e[o]=i.getUint8(a),a+=1;break;case y.Short:e[o]=i.getInt16(a,!0),a+=2;break;case y.UShort:e[o]=i.getUint16(a,!0),a+=2;break;case y.Int:e[o]=i.getInt32(a,!0),a+=4;break;case y.UInt:e[o]=i.getUint32(a,!0),a+=4;break;case y.Long:e[o]=Number(i.getBigInt64(a,!0)),a+=8;break;case y.ULong:e[o]=Number(i.getBigUint64(a,!0)),a+=8;break;case y.Float:e[o]=i.getFloat32(a,!0),a+=4;break;case y.Double:e[o]=i.getFloat64(a,!0),a+=8;break;case y.DateTime:case y.String:{let h=i.getUint32(a,!0);a+=4,e[o]=Pt.decode(r.subarray(a,a+h)),a+=h;break}case y.Json:{let h=i.getUint32(a,!0);a+=4;let c=Pt.decode(r.subarray(a,a+h));e[o]=JSON.parse(c),a+=h;break}case y.Binary:{let h=i.getUint32(a,!0);a+=4,e[o]=r.subarray(a,a+h),a+=h;break}default:throw Error(`Unknown type ${u.type}`)}}return e}const _t=new Uint8Array(0);function zt(){return this._source.cancel()}function jt(s,t){if(!s.length)return t;if(!t.length)return s;var e=new Uint8Array(s.length+t.length);return e.set(s),e.set(t,s.length),e}function qt(){var s=this,t=s._array.subarray(s._index);return s._source.read().then(function(e){return s._array=_t,s._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:jt(t,e.value)}})}function Gt(s){if((s|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+s<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=s));var r=new Uint8Array(s);return r.set(this._array.subarray(this._index)),(function i(){return t._source.read().then(function(n){return n.done?(t._array=_t,t._index=0,e>0?r.subarray(0,e):null):e+n.value.length>=s?(t._array=n.value,t._index=s-e,r.set(n.value.subarray(0,s-e),e),r):(r.set(n.value,e),e+=n.value.length,i())})})()}function Dt(s){return typeof s.slice=="function"?s:new et(typeof s.read=="function"?s:s.getReader())}function et(s){this._source=s,this._array=_t,this._index=0}et.prototype.read=qt;et.prototype.slice=Gt;et.prototype.cancel=zt;class P{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new P).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+q),(e||new P).__init(t.readInt32(t.position())+t.position(),t)}org(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,r,i,n,a,l){return P.startCrs(t),P.addOrg(t,e),P.addCode(t,r),P.addName(t,i),P.addDescription(t,n),P.addWkt(t,a),P.addCodeString(t,l),P.endCrs(t)}}class B{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new B).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+q),(e||new B).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}envelopeLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):I.Unknown}hasZ(){let t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasM(){let t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasT(){let t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasTm(){let t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}columns(t,e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){let e=this.bb.__offset(this.bb_pos,24);return e?(t||new P).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){let e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,I.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function rt(s){let t=B.getSizePrefixedRootAsHeader(s),e=t.featuresCount(),r=t.indexNodeSize(),i=[];for(let l=0;l<t.columnsLength();l++){let u=t.columns(l);if(!u)throw Error("Column unexpectedly missing");if(!u.name())throw Error("Column name unexpectedly missing");i.push({name:u.name(),type:u.type(),title:u.title(),description:u.description(),width:u.width(),precision:u.precision(),scale:u.scale(),nullable:u.nullable(),unique:u.unique(),primary_key:u.primaryKey()})}let n=t.crs(),a=n?{org:n.org(),code:n.code(),name:n.name(),description:n.description(),wkt:n.wkt(),code_string:n.codeString()}:null;return{geometryType:t.geometryType(),columns:i,envelope:t.envelopeLength()>0?t.envelopeArray():null,featuresCount:Number(e),indexNodeSize:r,crs:a,title:t.title(),description:t.description(),metadata:t.metadata()}}class st{static global=new st;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}}const Ht=40,Wt=16;function it(s,t){t=Math.min(Math.max(+t,2),65535);let e=s,r=e;do r+=e=Math.ceil(e/t);while(e!==1);return 40*r}function Xt(s,t){if(t<2)throw Error("Node size must be at least 2");if(s===0)throw Error("Number of items must be greater than 0");let e=s,r=e,i=[e];do r+=e=Math.ceil(e/t),i.push(e);while(e!==1);let n=[];for(let l of(e=r,i))n.push(e-l),e-=l;let a=[];for(let l=0;l<i.length;l++)a.push([n[l],n[l]+i[l]]);return a}async function*Tt(s,t,e,r){class i{_level;nodes;constructor(f,d){this._level=d,this.nodes=f}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(f){this.nodes[1]=f}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:n,minY:a,maxX:l,maxY:u}=e,o=Xt(s,t),h=o[0][0],c=[new i([0,1],o.length-1)];for(;c.length!==0;){let b=c.shift(),f=b.startNodeIdx(),d=f>=h,p=(()=>{let[,S]=o[b.level()],U=Math.min(b.endNodeIdx()+t,S);return d&&U<S?U+1:U})(),m=p-f,O=new DataView(await r(40*f,40*m));for(let S=f;S<p;S++){let U=S-f,D=40*U;if(l<O.getFloat64(D+0,!0)||u<O.getFloat64(D+8,!0)||n>O.getFloat64(D+16,!0)||a>O.getFloat64(D+24,!0))continue;let R=O.getBigUint64(D+32,!0);if(d){let at=(()=>{if(S<s-1){let Lt=(U+1)*40;return O.getBigUint64(Lt+32,!0)-R}return null})(),kt=S-h;yield[Number(R),kt,Number(at)];continue}let Nt=st.global.extraRequestThreshold()/40,M=c[c.length-1];if(M!==void 0&&M.level()===b.level()-1&&R<M.endNodeIdx()+Nt){M.extendEndNodeIdx(Number(R));continue}let It=(()=>{let at=b.level()-1;return new i([Number(R),Number(R)+1],at)})();M!==void 0&&(M.level(),It.level()),c.push(It)}}}class yt{bytes;header;headerLength;indexLength;constructor(t,e,r,i){this.bytes=t,this.header=e,this.headerLength=r,this.indexLength=i}static open(t){if(!t.subarray(0,3).every((a,l)=>x[l]===a))throw Error("Not a FlatGeobuf file");let e=new DataView(t.buffer).getUint32(x.length,!0);if(e>10485760||e<8)throw Error("Invalid header size");let r=t.subarray(x.length,x.length+T+e),i=rt(new C(r)),n=it(i.featuresCount,i.indexNodeSize);return new yt(t,i,e,n)}async*selectBbox(t){let e=this.lengthBeforeTree(),r=async(i,n)=>{let a=e+i;return this.bytes.slice(a,a+n).buffer};for await(let i of Tt(this.header.featuresCount,this.header.indexNodeSize,t,r)){let[n,a]=i,l=this.readFeature(n);yield{id:a,feature:l}}}lengthBeforeTree(){return x.length+T+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(t){let e=t+this.lengthBeforeFeatures(),r=new DataView(this.bytes.buffer).getUint32(e,!0),i=this.bytes.subarray(e+4,e+4+r),n=new Uint8Array(r+T);n.set(i,T);let a=new C(n);return F.getSizePrefixedRootAsFeature(a)}}var ct=function(s,t){return ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])},ct(s,t)};function Zt(s,t){ct(s,t);function e(){this.constructor=s}s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function j(s,t,e,r){function i(n){return n instanceof e?n:new e(function(a){a(n)})}return new(e||(e=Promise))(function(n,a){function l(h){try{o(r.next(h))}catch(c){a(c)}}function u(h){try{o(r.throw(h))}catch(c){a(c)}}function o(h){h.done?n(h.value):i(h.value).then(l,u)}o((r=r.apply(s,[])).next())})}function N(s,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(o){return function(h){return u([o,h])}}function u(o){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(n=o[0]&2?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,i=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){e.label=o[1];break}if(o[0]===6&&e.label<n[1]){e.label=n[1],n=o;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(o);break}n[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(s,e)}catch(h){o=[6,h],i=0}finally{r=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function G(s){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&s[t],r=0;if(e)return e.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&r>=s.length&&(s=void 0),{value:s&&s[r++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function W(s){return this instanceof W?(this.v=s,this):new W(s)}function $t(s,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(s,t||[]),i,n=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(b){r[b]&&(i[b]=function(f){return new Promise(function(d,p){n.push([b,f,d,p])>1||l(b,f)})})}function l(b,f){try{u(r[b](f))}catch(d){c(n[0][3],d)}}function u(b){b.value instanceof W?Promise.resolve(b.value.v).then(o,h):c(n[0][2],b)}function o(b){l("next",b)}function h(b){l("throw",b)}function c(b,f){b(f),n.shift(),n.length&&l(n[0][0],n[0][1])}}var At=(function(s){Zt(t,s);function t(e){var r=s.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return t})(Error);(function(){function s(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(s.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),s.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},s.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},s})();(function(){function s(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(s.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),s.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},s.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},s})();(function(){function s(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(s.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),s.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},s.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},s})();function ft(s){s!=null&&typeof s.then=="function"&&s.then(Q,Q)}var ut=0,St=1,L=2,Y=3,dt=4,K=1024,Q=function(){};function z(s){var t=s.err,e=Promise.resolve(s.execution).then(function(r){if(t!=null)throw t;return r});return s.err=void 0,s.execution=e.then(function(){},function(){}),s.pending===void 0?e:s.pending.then(function(){return e})}function k(s,t){var e=s.state>=Y;return Promise.resolve(t).then(function(r){return!e&&s.state>=dt?z(s).then(function(i){return{value:i,done:!0}}):{value:r,done:e}})}function gt(s,t){var e,r;if(!(s.state>=L))if(s.state=L,s.onnext(),s.onstop(),s.err==null&&(s.err=t),s.pushes.length===0&&(typeof s.buffer>"u"||s.buffer.empty))H(s);else try{for(var i=G(s.pushes),n=i.next();!n.done;n=i.next()){var a=n.value;a.resolve()}}catch(l){e={error:l}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}}function H(s){var t,e;if(!(s.state>=Y)){s.state<L&&gt(s),s.state=Y,s.buffer=void 0;try{for(var r=G(s.nexts),i=r.next();!i.done;i=r.next()){var n=i.value,a=s.pending===void 0?z(s):s.pending.then(function(){return z(s)});n.resolve(k(s,a))}}catch(l){t={error:l}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}s.pushes=[],s.nexts=[]}}function Bt(s){s.state>=dt||(s.state<Y&&H(s),s.state=dt)}function Jt(s,t){if(ft(t),s.pushes.length>=K)throw new At("No more than "+K+" pending calls to push are allowed on a single repeater.");if(s.state>=L)return Promise.resolve(void 0);var e=s.pending===void 0?Promise.resolve(t):s.pending.then(function(){return t});e=e.catch(function(u){s.state<L&&(s.err=u),Bt(s)});var r;if(s.nexts.length){var i=s.nexts.shift();i.resolve(k(s,e)),s.nexts.length?r=Promise.resolve(s.nexts[0].value):typeof s.buffer<"u"&&!s.buffer.full?r=Promise.resolve(void 0):r=new Promise(function(u){return s.onnext=u})}else typeof s.buffer<"u"&&!s.buffer.full?(s.buffer.add(e),r=Promise.resolve(void 0)):r=new Promise(function(u){return s.pushes.push({resolve:u,value:e})});var n=!0,a={},l=r.catch(function(u){if(n)throw u});return a.then=function(u,o){return n=!1,Promise.prototype.then.call(r,u,o)},a.catch=function(u){return n=!1,Promise.prototype.catch.call(r,u)},a.finally=r.finally.bind(r),s.pending=e.then(function(){return l}).catch(function(u){s.err=u,Bt(s)}),a}function Yt(s){var t=gt.bind(null,s),e=new Promise(function(r){return s.onstop=r});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function Kt(s){if(!(s.state>=St)){s.state=St;var t=Jt.bind(null,s),e=Yt(s);s.execution=new Promise(function(r){return r(s.executor(t,e))}),s.execution.catch(function(){return gt(s)})}}var $=new WeakMap,X=(function(){function s(t,e){$.set(this,{executor:t,buffer:e,err:void 0,state:ut,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Q,onstop:Q})}return s.prototype.next=function(t){ft(t);var e=$.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=K)throw new At("No more than "+K+" pending calls to next are allowed on a single repeater.");if(e.state<=ut&&Kt(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var r=k(e,e.buffer.remove());if(e.pushes.length){var i=e.pushes.shift();e.buffer.add(i.value),e.onnext=i.resolve}return r}else if(e.pushes.length){var n=e.pushes.shift();return e.onnext=n.resolve,k(e,n.value)}else if(e.state>=L)return H(e),k(e,z(e));return new Promise(function(a){return e.nexts.push({resolve:a,value:t})})},s.prototype.return=function(t){ft(t);var e=$.get(this);if(e===void 0)throw new Error("WeakMap error");return H(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),k(e,z(e))},s.prototype.throw=function(t){var e=$.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=ut||e.state>=L||typeof e.buffer<"u"&&!e.buffer.empty?(H(e),e.err==null&&(e.err=t),k(e,z(e))):this.next(Promise.reject(t))},s.prototype[Symbol.asyncIterator]=function(){return this},s.race=Qt,s.merge=te,s.zip=ee,s.latest=re,s})();function nt(s,t){var e,r,i=[],n=function(o){o!=null&&typeof o[Symbol.asyncIterator]=="function"?i.push(o[Symbol.asyncIterator]()):o!=null&&typeof o[Symbol.iterator]=="function"?i.push(o[Symbol.iterator]()):i.push((function(){return $t(this,arguments,function(){return N(this,function(h){switch(h.label){case 0:return t.yieldValues?[4,W(o)]:[3,3];case 1:return[4,h.sent()];case 2:h.sent(),h.label=3;case 3:return t.returnValues?[4,W(o)]:[3,5];case 4:return[2,h.sent()];case 5:return[2]}})})})())};try{for(var a=G(s),l=a.next();!l.done;l=a.next()){var u=l.value;n(u)}}catch(o){e={error:o}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return i}function Qt(s){var t=this,e=nt(s,{returnValues:!0});return new X(function(r,i){return j(t,void 0,void 0,function(){var n,a,l,u,o,h;return N(this,function(c){switch(c.label){case 0:if(!e.length)return i(),[2];a=!1,i.then(function(){n(),a=!0}),c.label=1;case 1:c.trys.push([1,,5,7]),u=void 0,o=0,h=function(){var b,f,d,p,m,O;return N(this,function(S){switch(S.label){case 0:b=o;try{for(f=(m=void 0,G(e)),d=f.next();!d.done;d=f.next())p=d.value,Promise.resolve(p.next()).then(function(U){U.done?(i(),l===void 0&&(l=U)):o===b&&(o++,n(U))},function(U){return i(U)})}catch(U){m={error:U}}finally{try{d&&!d.done&&(O=f.return)&&O.call(f)}finally{if(m)throw m.error}}return[4,new Promise(function(U){return n=U})];case 1:return u=S.sent(),u===void 0?[3,3]:[4,r(u.value)];case 2:S.sent(),S.label=3;case 3:return[2]}})},c.label=2;case 2:return a?[3,4]:[5,h()];case 3:return c.sent(),[3,2];case 4:return[2,l&&l.value];case 5:return i(),[4,Promise.race(e.map(function(b){return b.return&&b.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}function te(s){var t=this,e=nt(s,{yieldValues:!0});return new X(function(r,i){return j(t,void 0,void 0,function(){var n,a,l,u=this;return N(this,function(o){switch(o.label){case 0:if(!e.length)return i(),[2];n=[],a=!1,i.then(function(){var h,c;a=!0;try{for(var b=G(n),f=b.next();!f.done;f=b.next()){var d=f.value;d()}}catch(p){h={error:p}}finally{try{f&&!f.done&&(c=b.return)&&c.call(b)}finally{if(h)throw h.error}}}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,Promise.all(e.map(function(h,c){return j(u,void 0,void 0,function(){var b,f;return N(this,function(d){switch(d.label){case 0:d.trys.push([0,,6,9]),d.label=1;case 1:return a?[3,5]:(Promise.resolve(h.next()).then(function(p){return n[c](p)},function(p){return i(p)}),[4,new Promise(function(p){n[c]=p})]);case 2:return b=d.sent(),b===void 0?[3,4]:b.done?(l=b,[2]):[4,r(b.value)];case 3:d.sent(),d.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return f=h.return,f?[4,h.return()]:[3,8];case 7:f=d.sent(),d.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return o.sent(),[2,l&&l.value];case 3:return i(),[7];case 4:return[2]}})})})}function ee(s){var t=this,e=nt(s,{returnValues:!0});return new X(function(r,i){return j(t,void 0,void 0,function(){var n,a,l,u;return N(this,function(o){switch(o.label){case 0:if(!e.length)return i(),[2,[]];a=!1,i.then(function(){n(),a=!0}),o.label=1;case 1:o.trys.push([1,,6,8]),o.label=2;case 2:return a?[3,5]:(Promise.all(e.map(function(h){return h.next()})).then(function(h){return n(h)},function(h){return i(h)}),[4,new Promise(function(h){return n=h})]);case 3:return l=o.sent(),l===void 0?[2]:(u=l.map(function(h){return h.value}),l.some(function(h){return h.done})?[2,u]:[4,r(u)]);case 4:return o.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(e.map(function(h){return h.return&&h.return()}))];case 7:return o.sent(),[7];case 8:return[2]}})})})}function re(s){var t=this,e=nt(s,{yieldValues:!0,returnValues:!0});return new X(function(r,i){return j(t,void 0,void 0,function(){var n,a,l,u,o,h=this;return N(this,function(c){switch(c.label){case 0:if(!e.length)return i(),[2,[]];a=[],l=!1,i.then(function(){var b,f;n();try{for(var d=G(a),p=d.next();!p.done;p=d.next()){var m=p.value;m()}}catch(O){b={error:O}}finally{try{p&&!p.done&&(f=d.return)&&f.call(d)}finally{if(b)throw b.error}}l=!0}),c.label=1;case 1:return c.trys.push([1,,5,7]),Promise.all(e.map(function(b){return b.next()})).then(function(b){return n(b)},function(b){return i(b)}),[4,new Promise(function(b){return n=b})];case 2:return u=c.sent(),u===void 0?[2]:(o=u.map(function(b){return b.value}),u.every(function(b){return b.done})?[2,o]:[4,r(o.slice())]);case 3:return c.sent(),[4,Promise.all(e.map(function(b,f){return j(h,void 0,void 0,function(){var d;return N(this,function(p){switch(p.label){case 0:if(u[f].done)return[2,u[f].value];p.label=1;case 1:return l?[3,4]:(Promise.resolve(b.next()).then(function(m){return a[f](m)},function(m){return i(m)}),[4,new Promise(function(m){return a[f]=m})]);case 2:return d=p.sent(),d===void 0?[2,u[f].value]:d.done?[2,d.value]:(o[f]=d.value,[4,r(o.slice())]);case 3:return p.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,c.sent()];case 5:return i(),[4,Promise.all(e.map(function(b){return b.return&&b.return()}))];case 6:return c.sent(),[7];case 7:return[2]}})})})}class wt{headerClient;header;headerLength;indexLength;nocache;headers;constructor(t,e,r,i,n,a={}){this.headerClient=t,this.header=e,this.headerLength=r,this.indexLength=i,this.nocache=n,this.headers=a}static async open(t,e,r={}){let i,n=new Ct(t,e,r),a=2024+(()=>{let h,c=0;for(h=0;h<3;h++)c+=Wt**h*Ht;return c})();if(!new Uint8Array(await n.getRange(0,8,a,"header")).subarray(0,3).every((h,c)=>x[c]===h))throw Error("Not a FlatGeobuf file");if((i=new DataView(await n.getRange(8,4,a,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let l=await n.getRange(x.length,T+i,a,"header"),u=rt(new C(new Uint8Array(l)));if(u.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let o=it(u.featuresCount,u.indexNodeSize);return new wt(n,u,i,o,e,r)}async*selectBbox(t){let e=this.lengthBeforeTree(),r=this.headerClient,i=async(u,o)=>r.getRange(e+u,o,0,"index"),n=[],a=[];for await(let u of Tt(this.header.featuresCount,this.header.indexNodeSize,t,i)){let[o,h]=u,[,,c]=u;if(c||(c=4),a.length===0){a.push([o,c,h]);continue}let b=a[a.length-1];o-(b[0]+b[1])>st.global.extraRequestThreshold()&&(n.push(a),a=[]),a.push([o,c,h])}this.headerClient.logUsage("header+index"),a.length>0&&n.push(a);let l=n.flatMap(u=>this.readFeatureBatch(u,this.nocache));yield*X.merge(l)}lengthBeforeTree(){return x.length+T+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new Ct(this.headerClient.httpClient,t,this.headers)}async*readFeatureBatch(t,e){let[r]=t[0],[i,n]=t[t.length-1],a=this.buildFeatureClient(e),l=i+n-r;for(let[u,,o]of t){let h=await this.readFeature(a,u,l);yield{id:o,feature:h},l=0}a.logUsage("feature")}async readFeature(t,e,r){let i,n=e+this.lengthBeforeFeatures();i=new DataView(await t.getRange(n,4,r,"feature length")).getUint32(0,!0);let a=new Uint8Array(await t.getRange(n+4,i,r,"feature data")),l=new Uint8Array(i+T);l.set(a,T);let u=new C(l);return F.getSizePrefixedRootAsFeature(u)}}class Ct{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(t,e,r={}){if(typeof t=="string")this.httpClient=new Ot(t,e,r);else if(t instanceof Ot)this.httpClient=t;else throw Error("Unknown source")}async getRange(t,e,r,i){this.bytesEverUsed+=e;let n=t-this.head,a=n+e;if(n>=0&&a<=this.buffer.byteLength)return this.buffer.slice(n,a);let l=Math.max(e,r);return this.bytesEverFetched+=l,this.buffer=await this.httpClient.getRange(t,l,i),this.head=t,this.buffer.slice(0,e)}logUsage(t){t.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Ot{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(t,e,r={}){this.url=t,this.nocache=e,this.headers=r}async getRange(t,e,r){this.requestsEverMade+=1,this.bytesEverRequested+=e;let i=`bytes=${t}-${t+e-1}`,n=new Headers(this.headers);return n.set("Range",i),this.nocache&&n.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:n})).arrayBuffer()}}function se(s){let t;for(let e of s){if(t===I.Unknown)break;let r=e.getGeometry?J(e.getGeometry().getType()):J(e.geometry.type);t===void 0?t=r:t!==r&&(t=I.Unknown)}if(t===void 0)throw Error("Could not infer geometry type for collection of features.");return t}async function*ie(s,t,e,r){if(!s.subarray(0,3).every((c,b)=>x[b]===c))throw Error("Not a FlatGeobuf file");if(e){let c=yt.open(s);for await(let b of c.selectBbox(e))yield t(b.id,b.feature,c.header);return}let i=new C(s),n=i.readUint32(x.length);i.setPosition(x.length);let a=rt(i);r&&r(a);let l=x.length+T+n,{indexNodeSize:u,featuresCount:o}=a;u>0&&(l+=it(o,u));let h=0;for(;l<i.capacity();){let c=i.readUint32(l);i.setPosition(l);let b=F.getSizePrefixedRootAsFeature(i);yield t(h++,b,a),l+=T+c}}async function*ne(s,t,e){let r,i=Dt(s),n=async p=>await i.slice(p),a=new Uint8Array(await n(8));if(!a.subarray(0,3).every((p,m)=>x[m]===p))throw Error("Not a FlatGeobuf file");let l=new Uint8Array(await n(4)),u=new C(l),o=u.readUint32(0),h=new Uint8Array(await n(o));(a=new Uint8Array(l.length+h.length)).set(l),a.set(h,l.length);let c=rt(u=new C(a));e&&e(c);let{indexNodeSize:b,featuresCount:f}=c;if(b>0){let p=it(f,b);await n(p)}let d=0;for(;r=await oe(n,c,t,d++);)yield r}async function*ae(s,t,e,r,i=!1,n={}){let a=await wt.open(s,i,n);for await(let l of(r&&r(a.header),a.selectBbox(t)))yield e(l.id,l.feature,a.header)}async function oe(s,t,e,r){let i=new Uint8Array(await s(4,"feature length"));if(i.byteLength===0)return;let n=new C(i),a=n.readUint32(0);i=new Uint8Array(await s(a,"feature data"));let l=new Uint8Array(a+4);return l.set(i,4),n=new C(l),e(r,F.getSizePrefixedRootAsFeature(n),t)}function le(s,t=0){let e,r=new tt,i=0;s.columns&&(i=B.createColumnsVector(r,s.columns.map(l=>{let u;return u=r.createString(l.name),v.startColumn(r),v.addName(r,u),v.addType(r,l.type),v.endColumn(r)})));let n=r.createString("L1");t&&(P.startCrs(r),P.addCode(r,t),e=P.endCrs(r)),B.startHeader(r),e&&B.addCrs(r,e),B.addFeaturesCount(r,BigInt(s.featuresCount)),B.addGeometryType(r,s.geometryType),B.addIndexNodeSize(r,0),i&&B.addColumns(r,i),B.addName(r,n);let a=B.endHeader(r);return r.finishSizePrefixed(a),r.asUint8Array()}function ue(s,t){return{name:t,type:(function(e){if(typeof e=="boolean")return y.Bool;if(typeof e=="number")return y.Double;if(typeof e=="string"||e===null)return y.String;if(e instanceof Uint8Array)return y.Binary;if(typeof e=="object")return y.Json;throw Error(`Unknown type (value '${e}')`)})(s[t]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}}function mt(s){let t,e,r=s.coordinates,i=[],n=[],a=J(s.type),l=0;switch(s.type){case"Point":case"MultiPoint":case"LineString":bt(r,i,n);break;case"MultiLineString":case"Polygon":bt(r,i,n),r.length>1&&(t=r.map(u=>l+=u.length));break;case"MultiPolygon":e=r.map(u=>({type:"Polygon",coordinates:u})).map(mt)}return{xy:i,z:n.length>0?n:void 0,ends:t,type:a,parts:e}}function Et(s){let t=J(s.type),e=[];for(let r=0;r<s.geometries.length;r++){let i=s.geometries[r];i.type==="GeometryCollection"?e.push(Et(i)):e.push(mt(i))}return{type:t,parts:e}}function pt(s,t){let e=t;if(e===I.Unknown&&(e=s.type()),e===I.GeometryCollection){let i=[];for(let n=0;n<s.partsLength();n++){let a=s.parts(n),l=a.type();i.push(pt(a,l))}return{type:I[e],geometries:i}}if(e===I.MultiPolygon){let i=[];for(let n=0;n<s.partsLength();n++)i.push(pt(s.parts(n),I.Polygon));return{type:I[e],coordinates:i.map(n=>n.coordinates)}}let r=(function(i,n){let a=i.xyArray(),l=i.zArray();switch(n){case I.Point:{let u=Array.from(a);return l&&u.push(l[0]),u}case I.MultiPoint:case I.LineString:return lt(a,l);case I.MultiLineString:case I.Polygon:return(function(u,o,h){let c;if(!h||h.length===0)return[lt(u,o)];let b=0,f=Array.from(h).map(d=>u.slice(b,b=d<<1));return o&&(b=0,c=Array.from(h).map(d=>o.slice(b,b=d))),f.map((d,p)=>lt(d,c?c[p]:void 0))})(a,l,i.endsArray())}})(s,e);return{type:I[e],coordinates:r}}function vt(s,t,e){let r=e.columns;return{type:"Feature",id:s,geometry:pt(t.geometry(),e.geometryType),properties:Mt(t,r)}}function he(s,t=0){var e;let r,i,n=(r=(e=s).features[0].properties,i=null,r&&(i=Object.keys(r).map(c=>ue(r,c))),{geometryType:se(e.features),columns:i,featuresCount:e.features.length}),a=le(n,t),l=s.features.map(c=>Rt(c.geometry.type==="GeometryCollection"?Et(c.geometry):mt(c.geometry),c.properties,n)),u=l.map(c=>c.length).reduce((c,b)=>c+b),o=new Uint8Array(x.length+a.length+u);o.set(a,x.length);let h=x.length+a.length;for(let c of l)o.set(c,h),h+=c.length;return o.set(x),o}async function*be(s,t,e){yield*ie(s,vt,t,e)}function ce(s,t){return ne(s,vt,t)}function fe(s,t,e,r=!1,i={}){return ae(s,t,vt,e,r,i)}function de(s,t=0){return he(s,t)}function pe(s,t,e,r=!1,i={}){return s instanceof Uint8Array?be(s,t,e):s instanceof ReadableStream?ce(s,e):fe(s,t,e,r,i)}export{pe as deserialize,de as serialize};
