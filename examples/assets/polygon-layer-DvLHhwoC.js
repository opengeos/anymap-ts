import{n as I,S as F}from"./solid-polygon-layer-DvkMDu8v.js";import{P as J}from"./path-layer-BtOBY6v6.js";import{r as j}from"./utils-2CUC2toc.js";import{C as N}from"./composite-layer-dQcQCi_n.js";import{d as U,c as O}from"./mapbox-overlay-CjL5nCza.js";const b=[0,0,0,255],X=[0,0,0,255],G={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:C=>C.polygon},getFillColor:{type:"accessor",value:X},getLineColor:{type:"accessor",value:b},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class W extends N{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&U.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const n=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(n&&Array.isArray(t.dataChanged)){const l=this.state.paths.slice(),h=t.dataChanged.map(e=>j({data:l,getIndex:i=>i.__source.index,dataRange:e,replace:this._getPaths(e)}));this.setState({paths:l,pathsDiff:h})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:n,getPolygon:l,positionFormat:h,_normalize:e}=this.props,i=[],c=h==="XY"?2:3,{startRow:u,endRow:f}=t,{iterable:s,objectInfo:a}=O(n,u,f);for(const p of s){a.index++;let r=l(p,a);e&&(r=I(r,c));const{holeIndices:d}=r,y=r.positions||r;if(d)for(let g=0;g<=d.length;g++){const L=y.slice(d[g-1]||0,d[g]||y.length);i.push(this.getSubLayerRow({path:L},p,a.index))}else i.push(this.getSubLayerRow({path:y},p,a.index))}return i}renderLayers(){const{data:t,_dataDiff:n,stroked:l,filled:h,extruded:e,wireframe:i,_normalize:c,_windingOrder:u,elevationScale:f,transitions:s,positionFormat:a}=this.props,{lineWidthUnits:p,lineWidthScale:r,lineWidthMinPixels:d,lineWidthMaxPixels:y,lineJointRounded:g,lineMiterLimit:L,lineDashJustified:_}=this.props,{getFillColor:w,getLineColor:P,getLineWidth:A,getLineDashArray:D,getElevation:v,getPolygon:R,updateTriggers:o,material:M}=this.props,{paths:m,pathsDiff:S}=this.state,E=this.getSubLayerClass("fill",F),T=this.getSubLayerClass("stroke",J),x=this.shouldRenderSubLayer("fill",m)&&new E({_dataDiff:n,extruded:e,elevationScale:f,filled:h,wireframe:i,_normalize:c,_windingOrder:u,getElevation:v,getFillColor:w,getLineColor:e&&i?P:b,material:M,transitions:s},this.getSubLayerProps({id:"fill",updateTriggers:o&&{getPolygon:o.getPolygon,getElevation:o.getElevation,getFillColor:o.getFillColor,lineColors:e&&i,getLineColor:o.getLineColor}}),{data:t,positionFormat:a,getPolygon:R}),k=!e&&l&&this.shouldRenderSubLayer("stroke",m)&&new T({_dataDiff:S&&(()=>S),widthUnits:p,widthScale:r,widthMinPixels:d,widthMaxPixels:y,jointRounded:g,miterLimit:L,dashJustified:_,_pathType:"loop",transitions:s&&{getWidth:s.getLineWidth,getColor:s.getLineColor,getPath:s.getPolygon},getColor:this.getSubLayerAccessor(P),getWidth:this.getSubLayerAccessor(A),getDashArray:this.getSubLayerAccessor(D)},this.getSubLayerProps({id:"stroke",updateTriggers:o&&{getWidth:o.getLineWidth,getColor:o.getLineColor,getDashArray:o.getLineDashArray}}),{data:m,positionFormat:a,getPath:z=>z.path});return[!e&&x,k,e&&x]}}W.layerName="PolygonLayer";W.defaultProps=G;export{W as P};
