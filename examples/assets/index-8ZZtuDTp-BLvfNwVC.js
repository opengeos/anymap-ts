var w=Uint8Array,I=Uint16Array,Re=Int32Array,ge=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),me=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),je=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ye=function(e,t){for(var r=new I(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var i=new Re(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return{b:r,r:i}},ve=ye(ge,2),pe=ve.b,Ke=ve.r;pe[28]=258,Ke[258]=28;var We=ye(me,0),Ve=We.b,we=new I(32768);for(var g=0;g<32768;++g){var E=(g&43690)>>1|(g&21845)<<1;E=(E&52428)>>2|(E&13107)<<2,E=(E&61680)>>4|(E&3855)<<4,we[g]=((E&65280)>>8|(E&255)<<8)>>1}var O=(function(e,t,r){for(var n=e.length,i=0,a=new I(t);i<n;++i)e[i]&&++a[e[i]-1];var s=new I(t);for(i=1;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;var l;{l=new I(1<<t);var c=15-t;for(i=0;i<n;++i)if(e[i])for(var h=i<<4|e[i],u=t-e[i],o=s[e[i]-1]++<<u,d=o|(1<<u)-1;o<=d;++o)l[we[o]>>c]=h}return l}),k=new w(288);for(var g=0;g<144;++g)k[g]=8;for(var g=144;g<256;++g)k[g]=9;for(var g=256;g<280;++g)k[g]=7;for(var g=280;g<288;++g)k[g]=8;var be=new w(32);for(var g=0;g<32;++g)be[g]=5;var Je=O(k,9),Fe=O(be,5),_=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},T=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},G=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},Ne=function(e){return(e+7)/8|0},_e=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new w(e.subarray(t,r))},Ge=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],p=function(e,t,r){var n=new Error(t||Ge[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,p),!r)throw n;return n},Q=function(e,t,r,n){var i=e.length,a=0;if(!i||t.f&&!t.l)return r||new w(0);var s=!r,l=s||t.i!=2,c=t.i;s&&(r=new w(i*3));var h=function(he){var ue=r.length;if(he>ue){var de=new w(Math.max(ue*2,he));de.set(r),r=de}},u=t.f||0,o=t.p||0,d=t.b||0,v=t.l,m=t.d,A=t.m,D=t.n,B=i*8;do{if(!v){u=T(e,o,1);var R=T(e,o+1,3);if(o+=3,R)if(R==1)v=Je,m=Fe,A=9,D=5;else if(R==2){var j=T(e,o,31)+257,re=T(e,o+10,15)+4,ne=j+T(e,o+5,31)+1;o+=14;for(var H=new w(ne),K=new w(19),b=0;b<re;++b)K[je[b]]=T(e,o+b*3,7);o+=re*3;for(var ie=_(K),Oe=(1<<ie)-1,ke=O(K,ie),b=0;b<ne;){var ae=ke[T(e,o,Oe)];o+=ae&15;var C=ae>>4;if(C<16)H[b++]=C;else{var M=0,Z=0;for(C==16?(Z=3+T(e,o,3),o+=2,M=H[b-1]):C==17?(Z=3+T(e,o,7),o+=3):C==18&&(Z=11+T(e,o,127),o+=7);Z--;)H[b++]=M}}var se=H.subarray(0,j),U=H.subarray(j);A=_(se),D=_(U),v=O(se,A),m=O(U,D)}else p(1);else{var C=Ne(o)+4,W=e[C-4]|e[C-3]<<8,V=C+W;if(V>i){c&&p(0);break}l&&h(d+W),r.set(e.subarray(C,V),d),t.b=d+=W,t.p=o=V*8,t.f=u;continue}if(o>B){c&&p(0);break}}l&&h(d+131072);for(var Ze=(1<<A)-1,Se=(1<<D)-1,J=o;;J=o){var M=v[G(e,o)&Ze],z=M>>4;if(o+=M&15,o>B){c&&p(0);break}if(M||p(2),z<256)r[d++]=z;else if(z==256){J=o,v=null;break}else{var oe=z-254;if(z>264){var b=z-257,P=ge[b];oe=T(e,o,(1<<P)-1)+pe[b],o+=P}var F=m[G(e,o)&Se],N=F>>4;F||p(3),o+=F&15;var U=Ve[N];if(N>3){var P=me[N];U+=G(e,o)&(1<<P)-1,o+=P}if(o>B){c&&p(0);break}l&&h(d+131072);var le=d+oe;if(d<U){var ce=a-U,Be=Math.min(U,le);for(ce+d<0&&p(3);d<Be;++d)r[d]=n[ce+d]}for(;d<le;++d)r[d]=r[d-U]}}t.l=v,t.p=J,t.b=d,t.f=u,v&&(u=1,t.m=A,t.d=m,t.n=D)}while(!u);return d!=r.length&&s?_e(r,0,d):r.subarray(0,d)},qe=new w(0),Qe=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&p(6,"invalid gzip data");var t=e[3],r=10;t&4&&(r+=(e[10]|e[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(t&2)},Xe=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Ye=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&p(6,"invalid zlib data"),(e[1]>>5&1)==1&&p(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function et(e,t){return Q(e,{i:2},t,t)}function tt(e,t){var r=Qe(e);return r+8>e.length&&p(6,"invalid gzip data"),Q(e.subarray(r,-8),{i:2},new w(Xe(e)),t)}function rt(e,t){return Q(e.subarray(Ye(e),-4),{i:2},t,t)}function nt(e,t){return e[0]==31&&e[1]==139&&e[2]==8?tt(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?et(e,t):rt(e,t)}var it=typeof TextDecoder<"u"&&new TextDecoder,at=0;try{it.decode(qe,{stream:!0}),at=1}catch{}var st=Object.defineProperty,ot=Math.pow,f=(e,t)=>st(e,"name",{value:t,configurable:!0}),y=(e,t,r)=>new Promise((n,i)=>{var a=c=>{try{l(r.next(c))}catch(h){i(h)}},s=c=>{try{l(r.throw(c))}catch(h){i(h)}},l=c=>c.done?n(c.value):Promise.resolve(c.value).then(a,s);l((r=r.apply(e,t)).next())}),mt=f((e,t)=>{let r=!1,n="",i=L.GridLayer.extend({createTile:f((a,s)=>{let l=document.createElement("img"),c=new AbortController,h=c.signal;return l.cancel=()=>{c.abort()},r||(e.getHeader().then(u=>{u.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):u.tileType===2?n="image/png":u.tileType===3?n="image/jpeg":u.tileType===4?n="image/webp":u.tileType===5&&(n="image/avif")}),r=!0),e.getZxy(a.z,a.x,a.y,h).then(u=>{if(u){let o=new Blob([u.data],{type:n}),d=window.URL.createObjectURL(o);l.src=d}else l.style.display="none";l.cancel=void 0,s(void 0,l)}).catch(u=>{if(u.name!=="AbortError")throw u}),l},"createTile"),_removeTile:f(function(a){let s=this._tiles[a];s&&(s.el.cancel&&s.el.cancel(),s.el.width=0,s.el.height=0,s.el.deleted=!0,L.DomUtil.remove(s.el),delete this._tiles[a],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(t)},"leafletRasterLayer"),lt=f(e=>(t,r)=>{if(r instanceof AbortController)return e(t,r);let n=new AbortController;return e(t,n).then(i=>r(void 0,i.data,i.cacheControl||"",i.expires||""),i=>r(i)).catch(i=>r(i)),{cancel:f(()=>n.abort(),"cancel")}},"v3compat"),xe=class{constructor(e){this.tilev4=f((t,r)=>y(this,null,function*(){if(t.type==="json"){let d=t.url.substr(10),v=this.tiles.get(d);if(v||(v=new fe(d),this.tiles.set(d,v)),this.metadata){let A=yield v.getTileJson(t.url);return r.signal.throwIfAborted(),{data:A}}let m=yield v.getHeader();return r.signal.throwIfAborted(),(m.minLon>=m.maxLon||m.minLat>=m.maxLat)&&console.error(`Bounds of PMTiles archive ${m.minLon},${m.minLat},${m.maxLon},${m.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:m.minZoom,maxzoom:m.maxZoom,bounds:[m.minLon,m.minLat,m.maxLon,m.maxLat]}}}let n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),i=t.url.match(n);if(!i)throw new Error("Invalid PMTiles protocol URL");let a=i[1],s=this.tiles.get(a);s||(s=new fe(a),this.tiles.set(a,s));let l=i[2],c=i[3],h=i[4],u=yield s.getHeader(),o=yield s?.getZxy(+l,+c,+h,r.signal);if(r.signal.throwIfAborted(),o)return{data:new Uint8Array(o.data),cacheControl:o.cacheControl,expires:o.expires};if(u.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=lt(this.tilev4),this.tiles=new Map,this.metadata=e?.metadata||!1,this.errorOnMissingTile=e?.errorOnMissingTile||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};f(xe,"Protocol");var yt=xe;function Te(e,t){return(t>>>0)*4294967296+(e>>>0)}f(Te,"toNum");function Le(e,t){let r=t.buf,n=r[t.pos++],i=(n&112)>>4;if(n<128||(n=r[t.pos++],i|=(n&127)<<3,n<128)||(n=r[t.pos++],i|=(n&127)<<10,n<128)||(n=r[t.pos++],i|=(n&127)<<17,n<128)||(n=r[t.pos++],i|=(n&127)<<24,n<128)||(n=r[t.pos++],i|=(n&1)<<31,n<128))return Te(e,i);throw new Error("Expected varint not more than 10 bytes")}f(Le,"readVarintRemainder");function $(e){let t=e.buf,r=t[e.pos++],n=r&127;return r<128||(r=t[e.pos++],n|=(r&127)<<7,r<128)||(r=t[e.pos++],n|=(r&127)<<14,r<128)||(r=t[e.pos++],n|=(r&127)<<21,r<128)?n:(r=t[e.pos],n|=(r&15)<<28,Le(n,e))}f($,"readVarint");function X(e,t,r,n,i){return i===0?n!==0?[e-1-r,e-1-t]:[r,t]:[t,r]}f(X,"rotate");function Ce(e,t,r){if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(t>=1<<e||r>=1<<e)throw new Error("tile x/y outside zoom level bounds");let n=((1<<e)*(1<<e)-1)/3,i=e-1,[a,s]=[t,r];for(let l=1<<i;l>0;l>>=1){let c=a&l,h=s&l;n+=(3*c^h)*(1<<i),[a,s]=X(l,a,s,c,h),i--}return n}f(Ce,"zxyToTileId");function Ue(e){let t=3*e+1;return t<4294967296?31-Math.clz32(t):63-Math.clz32(t/4294967296)}f(Ue,"tileIdToZ");function ct(e){let t=Ue(e)>>1;if(t>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let r=((1<<t)*(1<<t)-1)/3,n=e-r,i=0,a=0,s=1<<t;for(let l=1;l<s;l<<=1){let c=l&n/2,h=l&(n^c);[i,a]=X(l,i,a,c,h),n=n/2,i+=c,a+=h}return[t,i,a]}f(ct,"tileIdToZxy");var ht=(e=>(e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.Gzip=2]="Gzip",e[e.Brotli=3]="Brotli",e[e.Zstd=4]="Zstd",e))(ht||{});function S(e,t){return y(this,null,function*(){if(t===1||t===0)return e;if(t===2){if(typeof globalThis.DecompressionStream>"u")return nt(new Uint8Array(e));let r=new Response(e).body;if(!r)throw new Error("Failed to read response stream");let n=r.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}f(S,"defaultDecompress");var ut=(e=>(e[e.Unknown=0]="Unknown",e[e.Mvt=1]="Mvt",e[e.Png=2]="Png",e[e.Jpeg=3]="Jpeg",e[e.Webp=4]="Webp",e[e.Avif=5]="Avif",e[e.Mlt=6]="Mlt",e))(ut||{});function Ee(e){return e===1?".mvt":e===2?".png":e===3?".jpg":e===4?".webp":e===5?".avif":e===6?".mlt":""}f(Ee,"tileTypeExt");var dt=127;function Ae(e,t){let r=0,n=e.length-1;for(;r<=n;){let i=n+r>>1,a=t-e[i].tileId;if(a>0)r=i+1;else if(a<0)n=i-1;else return e[i]}return n>=0&&(e[n].runLength===0||t-e[n].tileId<e[n].runLength)?e[n]:null}f(Ae,"findTile");var Me=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return y(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};f(Me,"FileSource");var vt=Me,ze=class{constructor(e,t=new Headers){var r,n;this.url=e,this.customHeaders=t,this.mustReload=!1;let i="";"navigator"in globalThis&&(i=(n=(r=globalThis.navigator)==null?void 0:r.userAgent)!=null?n:"");let a=i.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(i);this.chromeWindowsNoCache=!1,a&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,n){return y(this,null,function*(){let i,a;r?a=r:(i=new AbortController,a=i.signal);let s=new Headers(this.customHeaders);s.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let c=yield fetch(this.url,{signal:a,cache:l,headers:s});if(e===0&&c.status===416){let o=c.headers.get("Content-Range");if(!o||!o.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let d=+o.substr(8);c=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${d-1}`}})}let h=c.headers.get("Etag");if(h!=null&&h.startsWith("W/")&&(h=null),c.status===416||n&&h&&h!==n)throw this.mustReload=!0,new q(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw new Error(`Bad response code: ${c.status}`);let u=c.headers.get("Content-Length");if(c.status===200&&(!u||+u>t))throw i&&i.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:h||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};f(ze,"FetchSource");var ft=ze;function x(e,t){let r=e.getUint32(t+4,!0),n=e.getUint32(t+0,!0);return r*ot(2,32)+n}f(x,"getUint64");function $e(e,t){let r=new DataView(e),n=r.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:x(r,8),rootDirectoryLength:x(r,16),jsonMetadataOffset:x(r,24),jsonMetadataLength:x(r,32),leafDirectoryOffset:x(r,40),leafDirectoryLength:x(r,48),tileDataOffset:x(r,56),tileDataLength:x(r,64),numAddressedTiles:x(r,72),numTileEntries:x(r,80),numTileContents:x(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:t}}f($e,"bytesToHeader");function Y(e){let t={buf:new Uint8Array(e),pos:0},r=$(t),n=[],i=0;for(let a=0;a<r;a++){let s=$(t);n.push({tileId:i+s,offset:0,length:0,runLength:1}),i+=s}for(let a=0;a<r;a++)n[a].runLength=$(t);for(let a=0;a<r;a++)n[a].length=$(t);for(let a=0;a<r;a++){let s=$(t);s===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=s-1}return n}f(Y,"deserializeIndex");var De=class extends Error{};f(De,"EtagMismatch");var q=De;function ee(e,t){return y(this,null,function*(){let r=yield e.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=r.data.slice(0,dt),i=$e(n,r.etag),a=r.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),s=`${e.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,l=Y(yield t(a,i.internalCompression));return[i,[s,l.length,l]]})}f(ee,"getHeaderAndRoot");function te(e,t,r,n,i){return y(this,null,function*(){let a=yield e.getBytes(r,n,void 0,i.etag),s=yield t(a.data,i.internalCompression),l=Y(s);if(l.length===0)throw new Error("Empty directory is invalid");return l})}f(te,"getDirectory");var He=class{constructor(e=100,t=!0,r=S){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return y(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let n=yield ee(e,this.decompress);return n[1]&&this.cache.set(n[1][0],{lastUsed:this.counter++,data:n[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:n[0]}),this.prune(),n[0]})}getDirectory(e,t,r,n){return y(this,null,function*(){let i=`${e.getKey()}|${n.etag||""}|${t}|${r}`,a=this.cache.get(i);if(a)return a.lastUsed=this.counter++,a.data;let s=yield te(e,this.decompress,t,r,n);return this.cache.set(i,{lastUsed:this.counter++,data:s}),this.prune(),s})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,n)=>{r.lastUsed<e&&(e=r.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return y(this,null,function*(){this.cache.delete(e.getKey())})}};f(He,"ResolvedValueCache");var pt=He,Pe=class{constructor(e=100,t=!0,r=S){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return y(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let n=new Promise((i,a)=>{ee(e,this.decompress).then(s=>{s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:Promise.resolve(s[1][2])}),i(s[0]),this.prune()}).catch(s=>{a(s)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(e,t,r,n){return y(this,null,function*(){let i=`${e.getKey()}|${n.etag||""}|${t}|${r}`,a=this.cache.get(i);if(a)return a.lastUsed=this.counter++,yield a.data;let s=new Promise((l,c)=>{te(e,this.decompress,t,r,n).then(h=>{l(h),this.prune()}).catch(h=>{c(h)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,n)=>{r.lastUsed<e&&(e=r.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return y(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((n,i)=>{this.getHeader(e).then(a=>{n(),this.invalidations.delete(t)}).catch(a=>{i(a)})});this.invalidations.set(t,r)})}};f(Pe,"SharedPromiseCache");var gt=Pe,Ie=class{constructor(e,t,r){typeof e=="string"?this.source=new ft(e):this.source=e,r?this.decompress=r:this.decompress=S,t?this.cache=t:this.cache=new gt}getHeader(){return y(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,n){return y(this,null,function*(){let i=Ce(e,t,r),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let s=a.rootDirectoryOffset,l=a.rootDirectoryLength;for(let c=0;c<=3;c++){let h=yield this.cache.getDirectory(this.source,s,l,a),u=Ae(h,i);if(u){if(u.runLength>0){let o=yield this.source.getBytes(a.tileDataOffset+u.offset,u.length,n,a.etag);return{data:yield this.decompress(o.data,a.tileCompression),cacheControl:o.cacheControl,expires:o.expires}}s=a.leafDirectoryOffset+u.offset,l=u.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,n){return y(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,n)}catch(i){if(i instanceof q)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,n);throw i}})}getMetadataAttempt(){return y(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return y(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof q)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return y(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),n=Ee(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${n}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};f(Ie,"PMTiles");var fe=Ie;export{ht as Compression,q as EtagMismatch,ft as FetchSource,vt as FileSource,fe as PMTiles,yt as Protocol,pt as ResolvedValueCache,gt as SharedPromiseCache,ut as TileType,$e as bytesToHeader,Ae as findTile,x as getUint64,mt as leafletRasterLayer,$ as readVarint,ct as tileIdToZxy,Ee as tileTypeExt,Ce as zxyToTileId};
